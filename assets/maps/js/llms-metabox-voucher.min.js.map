{"version":3,"file":"../../js/llms-metabox-voucher.min.js","sources":["llms-metabox-voucher.js"],"sourcesContent":["( function( $ ) {\n\n\tvar deleteIds = [];\n\n\t$( document ).ready( function () {\n\n\t\tvar changeNotSaved          = false;\n\t\tvar codesAddedSinceLastSave = 0;\n\n\t\t$( '#llms_voucher_add_codes' ).click(function ( e ) {\n\t\t\te.preventDefault();\n\n\t\t\tvar qty  = $( '#llms_voucher_add_quantity' ).val();\n\t\t\tvar uses = $( '#llms_voucher_add_uses' ).val();\n\t\t\tvar html = '';\n\n\t\t\tchangeNotSaved = true;\n\n\t\t\tif ( $.isNumeric( qty ) && $.isNumeric( uses ) ) {\n\t\t\t\tif ( parseInt( qty ) > 0 && parseInt( uses ) > 0 ) {\n\n\t\t\t\t\tif ( qty > 50 ) {\n\t\t\t\t\t\talert( \"You can only generate 50 rows at a time\" );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcodesAddedSinceLastSave += parseInt( qty );\n\n\t\t\t\t\tif ( codesAddedSinceLastSave > 50 ) {\n\t\t\t\t\t\talert( \"Please save before adding any more codes, limit is 50 at a time\" );\n\t\t\t\t\t\tcodesAddedSinceLastSave -= parseInt( qty );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var i = 1; i <= parseInt( qty ); i++ ) {\n\t\t\t\t\t\thtml += '<tr>' +\n\t\t\t\t\t\t\t'<td></td>' +\n\t\t\t\t\t\t\t'<td>' +\n\t\t\t\t\t\t\t'<input type=\"text\" maxlength=\"20\" placeholder=\"Code\" value=\"' + randomizeCode() + '\" name=\"llms_voucher_code[]\">' +\n\t\t\t\t\t\t\t'<input type=\"hidden\" name=\"llms_voucher_code_id[]\" value=\"0\">' +\n\t\t\t\t\t\t\t'</td>' +\n\t\t\t\t\t\t\t'<td><span>0 / </span><input type=\"text\" placeholder=\"Uses\" value=\"' + uses + '\" class=\"llms-voucher-uses\" name=\"llms_voucher_uses[]\"></td>' +\n\t\t\t\t\t\t\t'<td><a href=\"#\" class=\"llms-voucher-delete\">' + delete_icon + '</a></td>' +\n\t\t\t\t\t\t\t'</tr>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$( '#llms_voucher_tbody' ).append( html );\n\n\t\t\tbindDeleteVoucherCode();\n\t\t} );\n\n\t\tbindDeleteVoucherCode();\n\n\t\t$( '#llms_voucher_tbody input' ).change( function() {\n\t\t\tchangeNotSaved = true;\n\t\t} );\n\n\t\t$( \"#post\" ).on( 'submit', function() {\n\t\t\tif ( $( '#publish' ).attr( 'name' ) === 'publish' ) {\n\t\t\t\t$( '<input />' ).attr( 'type', 'hidden' )\n\t\t\t\t\t.attr( 'name', \"publish\" )\n\t\t\t\t\t.attr( 'value', \"true\" )\n\t\t\t\t\t.appendTo( '#post' );\n\t\t\t}\n\t\t\treturn true;\n\t\t} );\n\n\t\twindow.onbeforeunload = function() {\n\t\t\treturn changeNotSaved ? \"If you leave this page you will lose your unsaved changes.\" : null;\n\t\t};\n\n\t\t$( 'input[type=submit][name=publish], input[type=submit][name=save]' ).click( function ( e ) {\n\t\t\tvar unique_values = {};\n\t\t\tvar duplicate     = false;\n\n\t\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each( function() {\n\t\t\t\tvar val = $( this ).val()\n\t\t\t\tif ( ! unique_values[val] ) {\n\t\t\t\t\tunique_values[val] = true;\n\t\t\t\t} else {\n\t\t\t\t\t$( this ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t\t\t\tduplicate = true;\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tif ( duplicate ) {\n\t\t\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If course or membership is not selected, don't allow user to save.\n\t\t\tif ( ! $( '#_llms_voucher_courses' ).val().length && ! $( '#_llms_voucher_membership' ).val().length ) {\n\t\t\t\talert( 'Please select course or membership before saving.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchangeNotSaved = false;\n\t\t\tcheck_voucher_duplicate();\n\t\t\treturn false;\n\t\t} );\n\n\t\tfunction bindDeleteVoucherCode() {\n\t\t\t$( '.llms-voucher-delete' ).unbind( 'click' );\n\t\t\t$( '.llms-voucher-delete' ).click( function ( e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar t   = $( this );\n\t\t\t\tvar old = t.data( 'id' );\n\n\t\t\t\tchangeNotSaved = true;\n\n\t\t\t\tif ( old ) {\n\t\t\t\t\tdeleteIds.push( old );\n\n\t\t\t\t\t$( '#delete_ids' ).val( deleteIds.join( ',' ) );\n\t\t\t\t} else {\n\t\t\t\t\tcodesAddedSinceLastSave--;\n\t\t\t\t}\n\n\t\t\t\t// remove html block\n\t\t\t\tt.closest( 'tr' ).remove();\n\t\t\t} );\n\t\t}\n\t} );\n\n\tfunction randomizeCode() {\n\t\tvar text     = '';\n\t\tvar possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n\t\tfor ( var i = 0; i < 12; i++ ) {\n\t\t\ttext += possible.charAt( Math.floor( Math.random() * possible.length ) );\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t/**\n\t * Check for voucher duplicates in other posts.\n\t *\n\t * @since Unknown\n\t * @since 5.9.0 Add nonce.\n\t * @since 7.1.3 Add check for empty vouchers.\n\t *\n\t * @return {void}\n\t */\n\tfunction check_voucher_duplicate() {\n\n\t\tvar vouchers = get_codes_from_inputs();\n\n\t\tif( ! vouchers.length ) {\n\t\t\t$( \"#post\" ).submit();\n\t\t\treturn;\n\t\t}\n\n\t\tvar data = {\n\t\t\taction: 'check_voucher_duplicate',\n\t\t\tpostId: $( '#post_ID' ).val(),\n\t\t\tcodes: vouchers,\n\t\t\t_ajax_nonce: window.llms.ajax_nonce,\n\t\t};\n\n\t\tvar ajax = new Ajax( 'post', data, false );\n\t\tajax.check_voucher_duplicate();\n\t}\n\n\tfunction get_codes_from_inputs() {\n\t\tvar codes = [];\n\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each( function() {\n\t\t\tcodes.push( $( this ).val() );\n\t\t} );\n\n\t\treturn codes;\n\t}\n\n} )( jQuery );\n\nfunction llms_on_voucher_duplicate( results ) {\n\tif ( results.length ) {\n\t\tfor ( var i = 0; i < results.length; i++ ) {\n\t\t\tjQuery( 'input[value=\"' + results[i].code + '\"]' ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t}\n\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t} else {\n\t\tjQuery( \"#post\" ).submit();\n\t}\n}\n"],"names":["llms_on_voucher_duplicate","results","length","i","jQuery","code","css","alert","submit","$","deleteIds","document","ready","changeNotSaved","codesAddedSinceLastSave","bindDeleteVoucherCode","unbind","click","e","preventDefault","t","this","old","data","push","val","join","closest","remove","qty","uses","html","isNumeric","parseInt","text","possible","charAt","Math","floor","random","delete_icon","append","change","on","attr","appendTo","window","onbeforeunload","vouchers","unique_values","duplicate","each","codes","action","postId","_ajax_nonce","llms","ajax_nonce","Ajax","check_voucher_duplicate"],"mappings":"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","sourceRoot":"../../js"}