!function(){var n=[],t=function(t){_.isEmpty(t._unsavedChanges)?n=_.filter(n,function(n){return t.cid!=n.cid}):_.findWhere(n,{cid:t.cid})||n.push(t)},e=function(t){var e,s=_.rest(arguments),i=function(n,t){return _.isBoolean(t)?t:(_.isString(t)?n[t]:t).apply(n,s)};return _.each(n,function(n){!e&&i(n,n._unsavedConfig[t])&&(e=n._unsavedConfig.prompt)}),e};Backbone.History.prototype.navigate=_.wrap(Backbone.History.prototype.navigate,function(n,t,s){var i=e("unloadRouterPrompt",t,s);i?confirm(i+" \n\nAre you sure you want to leave this page?")&&n.call(this,t,s):n.call(this,t,s)}),window.onbeforeunload=function(n){return e("unloadWindowPrompt",n)},_.extend(Backbone.Model.prototype,{unsaved:{},_trackingChanges:!1,_originalAttrs:{},_unsavedChanges:{},startTracking:function(){return this._unsavedConfig=_.extend({},{prompt:"You have unsaved changes!",unloadRouterPrompt:!1,unloadWindowPrompt:!1},this.unsaved||{}),this._trackingChanges=!0,this._resetTracking(),this._triggerUnsavedChanges(),this},stopTracking:function(){return this._trackingChanges=!1,this._originalAttrs={},this._unsavedChanges={},this._triggerUnsavedChanges(),this},restartTracking:function(){return this._resetTracking(),this._triggerUnsavedChanges(),this},resetAttributes:function(){if(this._trackingChanges)return this.attributes=this._originalAttrs,this._resetTracking(),this._triggerUnsavedChanges(),this},unsavedAttributes:function(n){if(!n)return!_.isEmpty(this._unsavedChanges)&&_.clone(this._unsavedChanges);var t,e=!1,s=this._unsavedChanges;for(var i in n)_.isEqual(s[i],t=n[i])||((e||(e={}))[i]=t);return e},_resetTracking:function(){this._originalAttrs=_.clone(this.attributes),this._unsavedChanges={}},_triggerUnsavedChanges:function(){this.trigger("unsavedChanges",!_.isEmpty(this._unsavedChanges),_.clone(this._unsavedChanges)),this.unsaved&&t(this)}}),Backbone.Model.prototype.set=_.wrap(Backbone.Model.prototype.set,function(n,t,e,s){var i,a;return null==t?this:("object"==typeof t?(i=t,s=e):(i={})[t]=e,s||(s={}),a=n.call(this,i,s),this._trackingChanges&&!s.silent&&(_.each(i,_.bind(function(n,t){_.isEqual(this._originalAttrs[t],n)?delete this._unsavedChanges[t]:this._unsavedChanges[t]=n},this)),this._triggerUnsavedChanges()),a)}),Backbone.sync=_.wrap(Backbone.sync,function(n,t,e,s){return s||(s={}),"update"==t&&(s.success=_.wrap(s.success,_.bind(function(n,t,s,i){var a;return n&&(a=n.call(this,t,s,i)),e._trackingChanges&&(e._resetTracking(),e._triggerUnsavedChanges()),a},this))),n(t,e,s)})}();