!function(h){window.llms=window.llms||{},window.llms.checkout=new function(){var o=[],s=[];return this.$checkout_form=h("#llms-product-purchase-form"),this.$confirm_form=h("#llms-product-purchase-confirm-form"),this.$form_sections=!1,this.form_action=!1,this.init=function(){var t=this;this.$checkout_form.length?(this.form_action="checkout",this.$form_sections=this.$checkout_form.find(".llms-checkout-section"),this.$checkout_form.on("submit",this,this.submit),h(".llms-password-strength-meter").length&&this.add_before_submit_event({data:LLMS.PasswordStrength,handler:LLMS.PasswordStrength.checkout}),this.bind_login(),this.bind_coupon(),this.bind_gateways()):this.$confirm_form.length&&(this.form_action="confirm",this.$form_sections=this.$confirm_form.find(".llms-checkout-section"),this.$confirm_form.on("submit",function(){t.processing("start")}))},this.add_before_submit_event=function(t){t.handler&&"function"==typeof t.handler&&(t.data||(t.data=null),o.push(t))},this.add_gateway=function(t){s.push(t)},this.bind_coupon=function(){var e=this;h('a[href="#llms-coupon-toggle"]').on("click",function(t){t.preventDefault(),h(".llms-coupon-entry").slideToggle(400)}),h("#llms-apply-coupon").on("click",function(t){t.preventDefault(),e.coupon_apply(h(this))}),h("#llms-remove-coupon").on("click",function(t){t.preventDefault(),e.coupon_remove(h(this))})},this.bind_gateways=function(){this.load_gateways(),h('input[name="llms_payment_gateway"]').length||h("#llms_create_pending_order").removeAttr("disabled"),h('input[name="llms_payment_gateway"]').on("change",function(){h('input[name="llms_payment_gateway"]').each(function(){var t=h(this),e=t.closest(".llms-payment-gateway"),s=e.find(".llms-gateway-fields").find("input, textarea, select"),o=t.is(":checked");e[o?"addClass":"removeClass"]("is-selected"),o?(s.removeAttr("disabled"),h(".llms-payment-gateways").trigger("llms-gateway-selected",{id:t.val(),$selector:e})):s.attr("disabled","disabled")})}),h(".llms-payment-gateways").on("llms-gateway-selected",function(t,e){var s=h("#llms_create_pending_order");e.$selector&&e.$selector.find(".llms-gateway-fields .invalid").length?s.attr("disabled","disabled"):s.removeAttr("disabled")})},this.bind_login=function(){h('a[href="#llms-show-login"]').on("click",function(t){t.preventDefault(),h(this).closest(".llms-info").slideUp(400),h("form.llms-login").slideDown(400)})},this.coupon_apply=function(t){var s=this,e=h("#llms_coupon_code").val(),o=h(".llms-coupon-messages"),n=o.find(".llms-error"),i=h("form.llms-checkout");LLMS.Spinner.start(i),window.LLMS.Ajax.call({data:{action:"validate_coupon_code",code:e,plan_id:h("#llms-plan-id").val()},beforeSend:function(){n.hide()},success:function(t){if(LLMS.Spinner.stop(i),"error"===t.code){var e=h("<li>"+t.message+"</li>");n.length?n.empty():(n=h('<ul class="llms-notice llms-error" />'),o.append(n)),e.appendTo(n),n.show()}else t.success&&(h(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),s.bind_coupon(),h(".llms-payment-gateways").replaceWith(t.data.gateways_html),s.bind_gateways(),h(".llms-order-summary").replaceWith(t.data.summary_html))}})},this.coupon_remove=function(t){var e=this,s=h("form.llms-checkout");LLMS.Spinner.start(s),window.LLMS.Ajax.call({data:{action:"remove_coupon_code",plan_id:h("#llms-plan-id").val()},success:function(t){LLMS.Spinner.stop(s),t.success&&(h(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),e.bind_coupon(),h(".llms-order-summary").replaceWith(t.data.summary_html),h(".llms-payment-gateways").replaceWith(t.data.gateways_html),e.bind_gateways())}})},this.load_gateways=function(){for(var t=0;t<=s.length;t++){var e=s[t];"object"==typeof e&&null!==e&&void 0!==e.bind&&"function"==typeof e.bind&&e.bind()}},this.processing=function(t){var e,s;switch(t){case"stop":e="removeClass";break;case"start":default:e="addClass"}"checkout"===this.form_action?s=this.$checkout_form:"confirm"===this.form_action&&(s=this.$confirm_form),s[e]("llms-is-processing"),LLMS.Spinner[t](this.$form_sections)},this.submit=function(t){var n,i=t.data,l=o.length,a=0,r=[],c=0,m=0;t.preventDefault(),i.processing("start"),h("#llms-checkout-errors").remove();for(var e=0;e<o.length;e++){var s=o[e];s.handler(s.data,function(t){c++,!0===t?m++:"string"==typeof t&&r.push(t)})}n=setInterval(function(){var t=!1,e=!1;if(6e4<=a)e=t=!0;else if(l===c)if(l===m)t=!0,i.$checkout_form.off("submit",i.submit),i.$checkout_form.trigger("submit");else if(r.length){e=t=!0;for(var s=h('<ul class="llms-notice llms-error" id="llms-checkout-errors" />'),o=0;o<r.length;o++)s.append("<li>"+r[o]+"</li>");h(".llms-checkout-wrapper").prepend(s),h("html, body").animate({scrollTop:s.offset().top-50},200)}t&&clearInterval(n),e&&i.processing("stop"),a++},100)},this.init(),this}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtZm9ybS1jaGVja291dC5qcyJdLCJuYW1lcyI6WyIkIiwid2luZG93IiwibGxtcyIsImNoZWNrb3V0IiwiYmVmb3JlX3N1Ym1pdCIsImdhdGV3YXlzIiwidGhpcyIsIiRjaGVja291dF9mb3JtIiwiJGNvbmZpcm1fZm9ybSIsIiRmb3JtX3NlY3Rpb25zIiwiZm9ybV9hY3Rpb24iLCJpbml0Iiwic2VsZiIsImxlbmd0aCIsImZpbmQiLCJvbiIsInN1Ym1pdCIsImFkZF9iZWZvcmVfc3VibWl0X2V2ZW50IiwiZGF0YSIsIkxMTVMiLCJQYXNzd29yZFN0cmVuZ3RoIiwiaGFuZGxlciIsImJpbmRfbG9naW4iLCJiaW5kX2NvdXBvbiIsImJpbmRfZ2F0ZXdheXMiLCJwcm9jZXNzaW5nIiwib2JqIiwicHVzaCIsImFkZF9nYXRld2F5IiwiZ2F0ZXdheV9jbGFzcyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlVG9nZ2xlIiwiY291cG9uX2FwcGx5IiwiY291cG9uX3JlbW92ZSIsImxvYWRfZ2F0ZXdheXMiLCJyZW1vdmVBdHRyIiwiZWFjaCIsIiRlbCIsIiRwYXJlbnQiLCJjbG9zZXN0IiwiJGZpZWxkcyIsImNoZWNrZWQiLCJpcyIsInRyaWdnZXIiLCJpZCIsInZhbCIsIiRzZWxlY3RvciIsImF0dHIiLCIkc3VibWl0Iiwic2xpZGVVcCIsInNsaWRlRG93biIsIiRidG4iLCJjb2RlIiwiJG1lc3NhZ2VzIiwiJGVycm9ycyIsIiRjb250YWluZXIiLCJTcGlubmVyIiwic3RhcnQiLCJBamF4IiwiY2FsbCIsImFjdGlvbiIsInBsYW5faWQiLCJiZWZvcmVTZW5kIiwiaGlkZSIsInN1Y2Nlc3MiLCJyIiwic3RvcCIsIiRtZXNzYWdlIiwibWVzc2FnZSIsImVtcHR5IiwiYXBwZW5kIiwiYXBwZW5kVG8iLCJzaG93IiwicmVwbGFjZVdpdGgiLCJjb3Vwb25faHRtbCIsImdhdGV3YXlzX2h0bWwiLCJzdW1tYXJ5X2h0bWwiLCJpIiwiZyIsInVuZGVmaW5lZCIsImJpbmQiLCJmdW5jIiwiJGZvcm0iLCJpbnRlcnZhbCIsIm51bSIsImNoZWNrcyIsImVycm9ycyIsImZpbmlzaGVzIiwic3VjY2Vzc2VzIiwicmVtb3ZlIiwic2V0SW50ZXJ2YWwiLCJjbGVhciIsIm9mZiIsIiRlcnIiLCJwcmVwZW5kIiwiYW5pbWF0ZSIsInNjcm9sbFRvcCIsIm9mZnNldCIsInRvcCIsImNsZWFySW50ZXJ2YWwiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJDQU1BLFNBQVlBLEdBc2ZYQyxPQUFPQyxLQUFPRCxPQUFPQyxNQUFRLEdBQzdCRCxPQUFPQyxLQUFLQyxTQUFXLElBcmZILFdBUW5CLElBQUlDLEVBQWdCLEdBUWhCQyxFQUFXLEdBZ2VmLE9BOWRBQyxLQUFLQyxlQUFpQlAsRUFBRywrQkFDekJNLEtBQUtFLGNBQWdCUixFQUFHLHVDQUN4Qk0sS0FBS0csZ0JBQWlCLEVBQ3RCSCxLQUFLSSxhQUFjLEVBUW5CSixLQUFLSyxLQUFPLFdBRVgsSUFBSUMsRUFBT04sS0FFTkEsS0FBS0MsZUFBZU0sUUFFeEJQLEtBQUtJLFlBQWMsV0FDbkJKLEtBQUtHLGVBQWlCSCxLQUFLQyxlQUFlTyxLQUFNLDBCQUVoRFIsS0FBS0MsZUFBZVEsR0FBSSxTQUFVVCxLQUFNQSxLQUFLVSxRQUd4Q2hCLEVBQUcsaUNBQWtDYSxRQUN6Q1AsS0FBS1csd0JBQXlCLENBQzdCQyxLQUFNQyxLQUFLQyxpQkFDWEMsUUFBU0YsS0FBS0MsaUJBQWlCakIsV0FJakNHLEtBQUtnQixhQUVMaEIsS0FBS2lCLGNBRUxqQixLQUFLa0IsaUJBRU1sQixLQUFLRSxjQUFjSyxTQUU5QlAsS0FBS0ksWUFBYyxVQUNuQkosS0FBS0csZUFBaUJILEtBQUtFLGNBQWNNLEtBQU0sMEJBRS9DUixLQUFLRSxjQUFjTyxHQUFJLFNBQVUsV0FDaENILEVBQUthLFdBQVksYUFnQnBCbkIsS0FBS1csd0JBQTBCLFNBQVVTLEdBRWxDQSxFQUFJTCxTQUFXLG1CQUFzQkssRUFBSUwsVUFJekNLLEVBQUlSLE9BQ1RRLEVBQUlSLEtBQU8s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R0EsRUFBSTFFLEVBQWNTLE9BQVFpRSxJQUFNLENBRWhELElBQUlwRCxFQUFNdEIsRUFBZTBFLEdBRXpCcEQsRUFBSUwsUUFBU0ssRUFBSVIsS0FBTSxTQUFVZ0QsR0FFaENzQixLQUNLLElBQVN0QixFQUNidUIsSUFDVyxpQkFBb0J2QixHQUMvQnFCLEVBQU81RCxLQUFNdUMsS0FRaEJrQixFQUFXTyxZQUFhLFdBRXZCLElBQUlDLEdBQVEsRUFDWHpCLEdBQU8sRUFHUixHQXZDYSxLQXVDUm1CLEVBR0puQixFQURBeUIsR0FBUSxPQUtKLEdBQUtQLElBQVFHLEVBR2pCLEdBQUtILElBQVFJLEVBRVpHLEdBQVEsRUFFUmhGLEVBQUtMLGVBQWVzRixJQUFLLFNBQVVqRixFQUFLSSxRQUN4Q0osRUFBS0wsZUFBZXFDLFFBQVMsZUFFdkIsR0FBSzJDLEVBQU8xRSxPQUFTLENBRzNCc0QsRUFEQXlCLEdBQVEsRUFLUixJQUZBLElBQUlFLEVBQU85RixFQUFHLG1FQUVKOEUsRUFBSSxFQUFHQSxFQUFJUyxFQUFPMUUsT0FBUWlFLElBQ25DZ0IsRUFBS3ZCLE9BQVEsT0FBU2dCLEVBQU9ULEdBQUssU0FHbkM5RSxFQUFHLDBCQUEyQitGLFFBQVNELEdBQ3ZDOUYsRUFBRyxjQUFlZ0csUUFBUyxDQUMxQkMsVUFBV0gsRUFBS0ksU0FBU0MsSUFBTSxJQUM3QixLQU1BUCxHQUNKUSxjQUFlaEIsR0FHWGpCLEdBQ0p2RCxFQUFLYSxXQUFZLFFBSWxCNkQsS0FFRSxNQUtKaEYsS0FBS0ssT0FFRUwsTUFsZlQsQ0F5ZksrRiIsImZpbGUiOiJsbG1zLWZvcm0tY2hlY2tvdXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWZ0ZXJMTVMgQ2hlY2tvdXQgU2NyZWVuIHJlbGF0ZWQgZXZlbnRzIGFuZCBpbnRlcmFjdGlvbnNcbiAqXG4gKiBAc2luY2UgICAgMy4wLjBcbiAqIEB2ZXJzaW9uICAzLjI0LjFcbiAqL1xuKCBmdW5jdGlvbiggJCApIHtcblxuXHR2YXIgbGxtc19jaGVja291dCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0LyoqXG5cdFx0ICogQXJyYXkgb2YgdmFsaWRhdGlvbiBmdW5jdGlvbnMgdG8gY2FsbCBvbiBmb3JtIHN1Ym1pc3Npb25cblx0XHQgKiBAdHlwZSAgICBhcnJheVxuXHRcdCAqIEBzaW5jZSAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gMy4wLjBcblx0XHQgKi9cblx0XHR2YXIgYmVmb3JlX3N1Ym1pdCA9IFtdOyAvLyBhcnJheSBvZiBmdW5jdGlvbnMgdG8gY2FsbCBiZWZvcmUgc3VibWl0dGluZyB0aGUgZm9ybVxuXG5cdFx0LyoqXG5cdFx0ICogQXJyYXkgb2YgZ2F0ZXdheXMgdG8gYmUgYXV0b21hdGljYWxseSBib3VuZCB3aGVuIG5lZWRlZFxuXHRcdCAqIEB0eXBlICAgIGFycmF5XG5cdFx0ICogQHNpbmNlICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAzLjAuMFxuXHRcdCAqL1xuXHRcdHZhciBnYXRld2F5cyA9IFtdO1xuXG5cdFx0dGhpcy4kY2hlY2tvdXRfZm9ybSA9ICQoICcjbGxtcy1wcm9kdWN0LXB1cmNoYXNlLWZvcm0nICk7XG5cdFx0dGhpcy4kY29uZmlybV9mb3JtID0gJCggJyNsbG1zLXByb2R1Y3QtcHVyY2hhc2UtY29uZmlybS1mb3JtJyApO1xuXHRcdHRoaXMuJGZvcm1fc2VjdGlvbnMgPSBmYWxzZTtcblx0XHR0aGlzLmZvcm1fYWN0aW9uID0gZmFsc2U7XG5cblx0XHQvKipcblx0XHQgKiBJbml0YWxpemUgY2hlY2tvdXQgSlMgJiBiaW5kIGlmIG9uIHRoZSBjaGVja291dCBzY3JlZW5cblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjI0LjFcblx0XHQgKi9cblx0XHR0aGlzLmluaXQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoIHRoaXMuJGNoZWNrb3V0X2Zvcm0ubGVuZ3RoICkge1xuXG5cdFx0XHRcdHRoaXMuZm9ybV9hY3Rpb24gPSAnY2hlY2tvdXQnO1xuXHRcdFx0XHR0aGlzLiRmb3JtX3NlY3Rpb25zID0gdGhpcy4kY2hlY2tvdXRfZm9ybS5maW5kKCAnLmxsbXMtY2hlY2tvdXQtc2VjdGlvbicgKTtcblxuXHRcdFx0XHR0aGlzLiRjaGVja291dF9mb3JtLm9uKCAnc3VibWl0JywgdGhpcywgdGhpcy5zdWJtaXQgKTtcblxuXHRcdFx0XHQvLyBhZGQgYmVmb3JlIHN1Ym1pdCBldmVudCBmb3IgcGFzc3dvcmQgc3RyZW5ndGggbWV0ZXIgaWYgb25lJ3MgZm91bmRcblx0XHRcdFx0aWYgKCAkKCAnLmxsbXMtcGFzc3dvcmQtc3RyZW5ndGgtbWV0ZXInICkubGVuZ3RoICkge1xuXHRcdFx0XHRcdHRoaXMuYWRkX2JlZm9yZV9zdWJtaXRfZXZlbnQoIHtcblx0XHRcdFx0XHRcdGRhdGE6IExMTVMuUGFzc3dvcmRTdHJlbmd0aCxcblx0XHRcdFx0XHRcdGhhbmRsZXI6IExMTVMuUGFzc3dvcmRTdHJlbmd0aC5jaGVja291dCxcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmJpbmRfbG9naW4oKTtcblxuXHRcdFx0XHR0aGlzLmJpbmRfY291cG9uKCk7XG5cblx0XHRcdFx0dGhpcy5iaW5kX2dhdGV3YXlzKCk7XG5cblx0XHRcdH0gZWxzZSBpZiAoIHRoaXMuJGNvbmZpcm1fZm9ybS5sZW5ndGggKSB7XG5cblx0XHRcdFx0dGhpcy5mb3JtX2FjdGlvbiA9ICdjb25maXJtJztcblx0XHRcdFx0dGhpcy4kZm9ybV9zZWN0aW9ucyA9IHRoaXMuJGNvbmZpcm1fZm9ybS5maW5kKCAnLmxsbXMtY2hlY2tvdXQtc2VjdGlvbicgKTtcblxuXHRcdFx0XHR0aGlzLiRjb25maXJtX2Zvcm0ub24oICdzdWJtaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzZWxmLnByb2Nlc3NpbmcoICdzdGFydCcgKTtcblx0XHRcdFx0fSApO1xuXG5cdFx0XHR9XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUHVibGljIGZ1bmN0aW9uIHdoaWNoIGFsbG93cyBvdGhlciBjbGFzc2VzIG9yIGV4dGVuc2lvbnMgdG8gYWRkXG5cdFx0ICogYmVmb3JlIHN1Ym1pdCBldmVudHMgdG8gbGxtcyBjaGVja291dCBwcml2YXRlIFwiYmVmb3JlX3N1Ym1pdFwiIGFycmF5XG5cdFx0ICogQHBhcmFtICAgIG9iamVjdCAgb2JqICBvYmplY3Qgb2YgZGF0YSB0byBwdXNoIHRvIHRoZSBhcnJheVxuXHRcdCAqICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZXMgYXQgbGVhc3QgYSBcImhhbmRsZXJcIiBrZXkgd2hpY2ggc2hvdWxkIHBhc3MgYSBjYWxsYWJsZSBmdW5jdGlvblxuXHRcdCAqICAgICAgICAgICAgICAgICAgICAgICAgXCJkYXRhXCIgY2FuIGJlIGFueXRoaW5nLCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyIHRvIHRoZSBoYW5kbGVyIGZ1bmN0aW9uXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5hZGRfYmVmb3JlX3N1Ym1pdF9ldmVudCA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cblx0XHRcdGlmICggIW9iai5oYW5kbGVyIHx8ICdmdW5jdGlvbicgIT09IHR5cGVvZiBvYmouaGFuZGxlciApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoICFvYmouZGF0YSApIHtcblx0XHRcdFx0b2JqLmRhdGEgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRiZWZvcmVfc3VibWl0LnB1c2goIG9iaiApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFB1YmxpYyBmdW5jdGlvbiB3aGljaCBhbGxvd3Mgb3RoZXIgY2xhc3NlcyBvciBleHRlbnNpb25zIHRvIGFkZFxuXHRcdCAqIGdhdGV3YXlzIGNsYXNzZXMgdGhhdCBzaG91bGQgYmUgYm91bmQgYnkgdGhpcyBjbGFzc1xuXHRcdCAqIEBwYXJhbSAgICBvYmogICBnYXRld2F5X2NsYXNzICBjYWxsYWJsZSBjbGFzcyBvYmplY3Rcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmFkZF9nYXRld2F5ID0gZnVuY3Rpb24oIGdhdGV3YXlfY2xhc3MgKSB7XG5cblx0XHRcdGdhdGV3YXlzLnB1c2goIGdhdGV3YXlfY2xhc3MgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCaW5kIGNvdXBvbiBhZGQgJiByZW1vdmUgYnV0dG9uIGV2ZW50c1xuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kX2NvdXBvbiA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIHNob3cgJiBoaWRlIHRoZSBjb3Vwb24gZmllbGQgJiBidXR0b25cblx0XHRcdCQoICdhW2hyZWY9XCIjbGxtcy1jb3Vwb24tdG9nZ2xlXCJdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoICcubGxtcy1jb3Vwb24tZW50cnknICkuc2xpZGVUb2dnbGUoIDQwMCApO1xuXG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGFwcGx5IGNvdXBvbiBjbGlja1xuXHRcdFx0JCggJyNsbG1zLWFwcGx5LWNvdXBvbicgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRzZWxmLmNvdXBvbl9hcHBseSggJCggdGhpcyApICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gcmVtb3ZlIGNvdXBvbiBjbGlja1xuXHRcdFx0JCggJyNsbG1zLXJlbW92ZS1jb3Vwb24nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0c2VsZi5jb3Vwb25fcmVtb3ZlKCAkKCB0aGlzICkgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgZ2F0ZXdheSBzZWN0aW9uIGV2ZW50c1xuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kX2dhdGV3YXlzID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHRoaXMubG9hZF9nYXRld2F5cygpO1xuXG5cdFx0XHRpZiAoICEgJCggJ2lucHV0W25hbWU9XCJsbG1zX3BheW1lbnRfZ2F0ZXdheVwiXScpLmxlbmd0aCApIHtcblx0XHRcdFx0JCggJyNsbG1zX2NyZWF0ZV9wZW5kaW5nX29yZGVyJyApLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gYWRkIGNsYXNzIGFuZCB0cmlnZ2VyIHdhdGNoYWJsZSBldmVudCB3aGVuIGdhdGV3YXkgc2VsZWN0aW9uIGNoYW5nZXNcblx0XHRcdCQoICdpbnB1dFtuYW1lPVwibGxtc19wYXltZW50X2dhdGV3YXlcIl0nICkub24oICdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcblxuIFx0XHRcdFx0JCggJ2lucHV0W25hbWU9XCJsbG1zX3BheW1lbnRfZ2F0ZXdheVwiXScgKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRcdHZhciAkZWwgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0XHQkcGFyZW50ID0gJGVsLmNsb3Nlc3QoICcubGxtcy1wYXltZW50LWdhdGV3YXknICksXG5cdFx0XHRcdFx0XHQkZmllbGRzID0gJHBhcmVudC5maW5kKCAnLmxsbXMtZ2F0ZXdheS1maWVsZHMnICkuZmluZCggJ2lucHV0LCB0ZXh0YXJlYSwgc2VsZWN0JyApLFxuXHRcdFx0XHRcdFx0Y2hlY2tlZCA9ICRlbC5pcyggJzpjaGVja2VkJyApLFxuXHRcdFx0XHRcdFx0ZGlzcGxheV9mdW5jID0gKCBjaGVja2VkICkgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJztcblxuXHRcdFx0XHRcdCRwYXJlbnRbIGRpc3BsYXlfZnVuYyBdKCAnaXMtc2VsZWN0ZWQnICk7XG5cblx0XHRcdFx0XHRpZiAoIGNoZWNrZWQgKSB7XG5cblx0XHRcdFx0XHRcdC8vIGVuYWJsZSBmaWVsZHNcblx0XHRcdFx0XHRcdCRmaWVsZHMucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApO1xuXG5cdFx0XHRcdFx0XHQvLyBlbWl0IGEgd2F0Y2hhYmxlIGV2ZW50IGZvciBleHRlbnNpb25zIHRvIGhvb2sgb250b1xuXHRcdFx0XHRcdFx0JCggJy5sbG1zLXBheW1lbnQtZ2F0ZXdheXMnICkudHJpZ2dlciggJ2xsbXMtZ2F0ZXdheS1zZWxlY3RlZCcsIHtcblx0XHRcdFx0XHRcdFx0aWQ6ICRlbC52YWwoKSxcblx0XHRcdFx0XHRcdFx0JHNlbGVjdG9yOiAkcGFyZW50LFxuXHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0Ly8gZGlzYWJsZSBmaWVsZHNcblx0XHRcdFx0XHRcdCRmaWVsZHMuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBlbmFibGUgLyBkaXNhYmxlIGJ1dHRvbnMgZGVwZW5kaW5nIG9uIGZpZWxkIHZhbGlkYXRpb24gc3RhdHVzXG5cdFx0XHQkKCAnLmxsbXMtcGF5bWVudC1nYXRld2F5cycgKS5vbiggJ2xsbXMtZ2F0ZXdheS1zZWxlY3RlZCcsIGZ1bmN0aW9uKCBlLCBkYXRhICkge1xuXG5cdFx0XHRcdHZhciAkc3VibWl0ID0gJCggJyNsbG1zX2NyZWF0ZV9wZW5kaW5nX29yZGVyJyApO1xuXG5cdFx0XHRcdGlmICggZGF0YS4kc2VsZWN0b3IgJiYgZGF0YS4kc2VsZWN0b3IuZmluZCggJy5sbG1zLWdhdGV3YXktZmllbGRzIC5pbnZhbGlkJyApLmxlbmd0aCApIHtcblx0XHRcdFx0XHQkc3VibWl0LmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkc3VibWl0LnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9ICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQmluZCBjbGljayBldmVudHMgZm9yIHRoZSBTaG93IC8gSGlkZSBsb2dpbiBhcmVhIGF0IHRoZSB0b3Agb2YgdGhlIGNoZWNrb3V0IHNjcmVlblxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kX2xvZ2luID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdCQoICdhW2hyZWY9XCIjbGxtcy1zaG93LWxvZ2luXCJdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoIHRoaXMgKS5jbG9zZXN0KCAnLmxsbXMtaW5mbycgKS5zbGlkZVVwKCA0MDAgKTtcblx0XHRcdFx0JCggJ2Zvcm0ubGxtcy1sb2dpbicgKS5zbGlkZURvd24oIDQwMCApO1xuXG5cdFx0XHR9ICk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFRyaWdnZXJlZCBieSBjbGlja2luZyB0aGUgXCJBcHBseSBDb3Vwb25cIiBCdXR0b25cblx0XHQgKiBWYWxpZGF0ZXMgdGhlIGNvdXBvbiB2aWEgSlMgYW5kIGFkZHMgZXJyb3IgLyBzdWNjZXNzIG1lc3NhZ2VzXG5cdFx0ICogT24gc3VjY2VzcyBpdCB3aWxsIHJlcGxhY2UgcGFydGlhbHMgb24gdGhlIGNoZWNrb3V0IHNjcmVlbiB3aXRoIHVwZGF0ZWRcblx0XHQgKiBwcmljZXMgYW5kIGEgXCJyZW1vdmUgY291cG9uXCIgYnV0dG9uXG5cdFx0ICogQHBhcmFtICAgIG9iaiAgICRidG4gIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgQXBwbHkgYnV0dG9uXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmNvdXBvbl9hcHBseSA9IGZ1bmN0aW9uICggJGJ0biApIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHQkY29kZSA9ICQoICcjbGxtc19jb3Vwb25fY29kZScgKSxcblx0XHRcdFx0Y29kZSA9ICRjb2RlLnZhbCgpLFxuXHRcdFx0XHQkbWVzc2FnZXMgPSAkKCAnLmxsbXMtY291cG9uLW1lc3NhZ2VzJyApLFxuXHRcdFx0XHQkZXJyb3JzID0gJG1lc3NhZ2VzLmZpbmQoICcubGxtcy1lcnJvcicgKSxcblx0XHRcdFx0JGNvbnRhaW5lciA9ICQoICdmb3JtLmxsbXMtY2hlY2tvdXQnICk7XG5cblx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggJGNvbnRhaW5lciApO1xuXG5cdFx0XHR3aW5kb3cuTExNUy5BamF4LmNhbGwoIHtcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ3ZhbGlkYXRlX2NvdXBvbl9jb2RlJyxcblx0XHRcdFx0XHRjb2RlOiBjb2RlLFxuXHRcdFx0XHRcdHBsYW5faWQ6ICQoICcjbGxtcy1wbGFuLWlkJyApLnZhbCgpLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRiZWZvcmVTZW5kOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRcdCRlcnJvcnMuaGlkZSgpO1xuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0TExNUy5TcGlubmVyLnN0b3AoICRjb250YWluZXIgKTtcblxuXHRcdFx0XHRcdGlmICggJ2Vycm9yJyA9PT0gci5jb2RlICkge1xuXG5cdFx0XHRcdFx0XHR2YXIgJG1lc3NhZ2UgPSAkKCAnPGxpPicgKyByLm1lc3NhZ2UgKyAnPC9saT4nKTtcblxuXHRcdFx0XHRcdFx0aWYgKCAhICRlcnJvcnMubGVuZ3RoICkge1xuXG5cdFx0XHRcdFx0XHRcdCRlcnJvcnMgPSAkKCAnPHVsIGNsYXNzPVwibGxtcy1ub3RpY2UgbGxtcy1lcnJvclwiIC8+JyApO1xuXHRcdFx0XHRcdFx0XHQkbWVzc2FnZXMuYXBwZW5kKCAkZXJyb3JzICk7XG5cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0JGVycm9ycy5lbXB0eSgpO1xuXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdCRtZXNzYWdlLmFwcGVuZFRvKCAkZXJyb3JzICk7XG5cdFx0XHRcdFx0XHQkZXJyb3JzLnNob3coKTtcblxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoIHIuc3VjY2VzcyApIHtcblxuXHRcdFx0XHRcdFx0JCggJy5sbG1zLWNvdXBvbi13cmFwcGVyJyApLnJlcGxhY2VXaXRoKCByLmRhdGEuY291cG9uX2h0bWwgKTtcblx0XHRcdFx0XHRcdHNlbGYuYmluZF9jb3Vwb24oKTtcblxuXHRcdFx0XHRcdFx0JCggJy5sbG1zLXBheW1lbnQtZ2F0ZXdheXMnICkucmVwbGFjZVdpdGgoIHIuZGF0YS5nYXRld2F5c19odG1sICk7XG5cdFx0XHRcdFx0XHRzZWxmLmJpbmRfZ2F0ZXdheXMoKTtcblxuXHRcdFx0XHRcdFx0JCggJy5sbG1zLW9yZGVyLXN1bW1hcnknICkucmVwbGFjZVdpdGgoIHIuZGF0YS5zdW1tYXJ5X2h0bWwgKTtcblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgYnkgY2xpY2tpbmcgdGhlIFwiUmVtb3ZlIENvdXBvblwiIGJ1dHRvblxuXHRcdCAqIFJlbW92ZXMgdGhlIGNvdXBvbiB2aWEgQUpBWCBhbmQgdW5zZXRzIHJlbGF0ZWQgc2Vzc2lvbiBkYXRhXG5cdFx0ICogQHBhcmFtICAgIG9iaiAgICRidG4gIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgUmVtb3ZlIGJ1dHRvblxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5jb3Vwb25fcmVtb3ZlID0gZnVuY3Rpb24oICRidG4gKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0JGNvbnRhaW5lciA9ICQoICdmb3JtLmxsbXMtY2hlY2tvdXQnICk7XG5cblx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggJGNvbnRhaW5lciApO1xuXG5cdFx0XHR3aW5kb3cuTExNUy5BamF4LmNhbGwoIHtcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ3JlbW92ZV9jb3Vwb25fY29kZScsXG5cdFx0XHRcdFx0cGxhbl9pZDogJCggJyNsbG1zLXBsYW4taWQnICkudmFsKCksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0TExNUy5TcGlubmVyLnN0b3AoICRjb250YWluZXIgKTtcblxuXHRcdFx0XHRcdGlmICggci5zdWNjZXNzICkge1xuXG5cdFx0XHRcdFx0XHQkKCAnLmxsbXMtY291cG9uLXdyYXBwZXInICkucmVwbGFjZVdpdGgoIHIuZGF0YS5jb3Vwb25faHRtbCApO1xuXHRcdFx0XHRcdFx0c2VsZi5iaW5kX2NvdXBvbigpO1xuXG5cdFx0XHRcdFx0XHQkKCAnLmxsbXMtb3JkZXItc3VtbWFyeScgKS5yZXBsYWNlV2l0aCggci5kYXRhLnN1bW1hcnlfaHRtbCApO1xuXG5cdFx0XHRcdFx0XHQkKCAnLmxsbXMtcGF5bWVudC1nYXRld2F5cycgKS5yZXBsYWNlV2l0aCggci5kYXRhLmdhdGV3YXlzX2h0bWwgKTtcblx0XHRcdFx0XHRcdHNlbGYuYmluZF9nYXRld2F5cygpO1xuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgZXh0ZXJuYWwgZ2F0ZXdheSBKU1xuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5sb2FkX2dhdGV3YXlzID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdGZvciAoIHZhciBpID0gMDsgaSA8PSBnYXRld2F5cy5sZW5ndGg7IGkrKyApIHtcblx0XHRcdFx0dmFyIGcgPSBnYXRld2F5c1tpXTtcblx0XHRcdFx0aWYgKCB0eXBlb2YgZyA9PT0gJ29iamVjdCcgJiYgZyAhPT0gbnVsbCApIHtcblx0XHRcdFx0XHRpZiAoIGcuYmluZCAhPT0gdW5kZWZpbmVkICYmICdmdW5jdGlvbicgPT09IHR5cGVvZiBnLmJpbmQgICkge1xuXHRcdFx0XHRcdFx0Zy5iaW5kKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFN0YXJ0IG9yIHN0b3AgcHJvY2Nlc3NpbmcgZXZlbnRzIG9uIHRoZSBjaGVja291dCBmb3JtXG5cdFx0ICogQHBhcmFtICAgIHN0cmluZyAgIGFjdGlvbiAgd2hldGhlciB0byBzdGFydCBvciBzdG9wIHByb2Nlc3NpbmcgW3N0YXJ0fHN0b3BdXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4yNC4xXG5cdFx0ICovXG5cdFx0dGhpcy5wcm9jZXNzaW5nID0gZnVuY3Rpb24oIGFjdGlvbiApIHtcblxuXHRcdFx0dmFyIGZ1bmMsICRmb3JtO1xuXG5cdFx0XHRzd2l0Y2ggKCBhY3Rpb24gKSB7XG5cblx0XHRcdFx0Y2FzZSAnc3RvcCc6XG5cdFx0XHRcdFx0ZnVuYyA9ICdyZW1vdmVDbGFzcyc7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgJ3N0YXJ0Jzpcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRmdW5jID0gJ2FkZENsYXNzJztcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdH1cblxuXHRcdFx0aWYgKCAnY2hlY2tvdXQnID09PSB0aGlzLmZvcm1fYWN0aW9uICkge1xuXHRcdFx0XHQkZm9ybSA9IHRoaXMuJGNoZWNrb3V0X2Zvcm07XG5cdFx0XHR9IGVsc2UgaWYgKCAnY29uZmlybScgPT09IHRoaXMuZm9ybV9hY3Rpb24gKSB7XG5cdFx0XHRcdCRmb3JtID0gdGhpcy4kY29uZmlybV9mb3JtO1xuXHRcdFx0fVxuXG5cdFx0XHQkZm9ybVsgZnVuYyBdKCAnbGxtcy1pcy1wcm9jZXNzaW5nJyApO1xuXHRcdFx0TExNUy5TcGlubmVyWyBhY3Rpb24gXSggdGhpcy4kZm9ybV9zZWN0aW9ucyApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEhhbmRsZXMgZm9ybSBzdWJtaXNzaW9uXG5cdFx0ICogQ2FsbHMgYWxsIHZhbGlkYXRpb24gZXZlbnRzIGluIGBiZWZvcmVfc3VibWl0W11gXG5cdFx0ICogd2FpdHMgZm9yIGNhbGwgYmFja3MgYW5kIGVpdGhlciBkaXNwbGF5cyByZXR1cm5lZCBlcnJvcnNcblx0XHQgKiBvciBzdWJtaXRzIHRoZSBmb3JtIHdoZW4gYWxsIGFyZSBzdWNjZXNmdWxcblx0XHQgKiBAcGFyYW0gICAgb2JqICAgZSAgSlMgZXZlbnQgb2JqZWN0XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLnN1Ym1pdCA9IGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IGUuZGF0YSxcblx0XHRcdFx0bnVtID0gYmVmb3JlX3N1Ym1pdC5sZW5ndGgsXG5cdFx0XHRcdGNoZWNrcyA9IDAsXG5cdFx0XHRcdG1heF9jaGVja3MgPSA2MDAwMCxcblx0XHRcdFx0ZXJyb3JzID0gW10sXG5cdFx0XHRcdGZpbmlzaGVzID0gMCxcblx0XHRcdFx0c3VjY2Vzc2VzID0gMCxcblx0XHRcdFx0aW50ZXJ2YWw7XG5cblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0Ly8gYWRkIHNwaW5uZXJzXG5cdFx0XHRzZWxmLnByb2Nlc3NpbmcoICdzdGFydCcgKTtcblxuXHRcdFx0Ly8gcmVtb3ZlIGVycm9ycyB0byBwcmV2ZW50IGR1cGxpY2F0ZXNcblx0XHRcdCQoICcjbGxtcy1jaGVja291dC1lcnJvcnMnICkucmVtb3ZlKCk7XG5cblx0XHRcdC8vIHN0YXJ0IHJ1bm5pbmcgYWxsIHRoZSBldmVudHNcblx0XHRcdGZvciAoIHZhciBpID0gMDsgaSA8IGJlZm9yZV9zdWJtaXQubGVuZ3RoOyBpKysgKSB7XG5cblx0XHRcdFx0dmFyIG9iaiA9IGJlZm9yZV9zdWJtaXRbIGkgXTtcblxuXHRcdFx0XHRvYmouaGFuZGxlciggb2JqLmRhdGEsIGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0ZmluaXNoZXMrKztcblx0XHRcdFx0XHRpZiAoIHRydWUgPT09IHIgKSB7XG5cdFx0XHRcdFx0XHRzdWNjZXNzZXMrKztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKCAnc3RyaW5nJyA9PT0gdHlwZW9mIHIgKSB7XG5cdFx0XHRcdFx0XHRlcnJvcnMucHVzaCggciApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9ICk7XG5cblx0XHRcdH1cblxuXHRcdFx0Ly8gcnVuIGFuIGludGVydmFsIHRvIHdhaXQgZm9yIGZpbmlzaGVzXG5cdFx0XHRpbnRlcnZhbCA9IHNldEludGVydmFsKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgY2xlYXIgPSBmYWxzZSxcblx0XHRcdFx0XHRzdG9wID0gZmFsc2U7XG5cblx0XHRcdFx0Ly8gdGltZW91dC4uLlxuXHRcdFx0XHRpZiAoIGNoZWNrcyA+PSBtYXhfY2hlY2tzICkge1xuXG5cdFx0XHRcdFx0Y2xlYXIgPSB0cnVlO1xuXHRcdFx0XHRcdHN0b3AgPSB0cnVlO1xuXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gZXZlcnl0aGluZyBoYXMgZmluaXNoZWRcblx0XHRcdFx0ZWxzZSBpZiAoIG51bSA9PT0gZmluaXNoZXMgKSB7XG5cblx0XHRcdFx0XHQvLyBhbGwgd2VyZSBzdWNjZXNmdWwsIHN1Ym1pdCB0aGUgZm9ybVxuXHRcdFx0XHRcdGlmICggbnVtID09PSBzdWNjZXNzZXMgKSB7XG5cblx0XHRcdFx0XHRcdGNsZWFyID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0c2VsZi4kY2hlY2tvdXRfZm9ybS5vZmYoICdzdWJtaXQnLCBzZWxmLnN1Ym1pdCApO1xuXHRcdFx0XHRcdFx0c2VsZi4kY2hlY2tvdXRfZm9ybS50cmlnZ2VyKCAnc3VibWl0JyApO1xuXG5cdFx0XHRcdFx0fSBlbHNlIGlmICggZXJyb3JzLmxlbmd0aCApIHtcblxuXHRcdFx0XHRcdFx0Y2xlYXIgPSB0cnVlO1xuXHRcdFx0XHRcdFx0c3RvcCA9IHRydWU7XG5cblx0XHRcdFx0XHRcdHZhciAkZXJyID0gJCggJzx1bCBjbGFzcz1cImxsbXMtbm90aWNlIGxsbXMtZXJyb3JcIiBpZD1cImxsbXMtY2hlY2tvdXQtZXJyb3JzXCIgLz4nKVxuXG5cdFx0XHRcdFx0XHRmb3IgKCB2YXIgaSA9IDA7IGkgPCBlcnJvcnMubGVuZ3RoOyBpKysgKSB7XG5cdFx0XHRcdFx0XHRcdCRlcnIuYXBwZW5kKCAnPGxpPicgKyBlcnJvcnNbaV0gKyAnPC9saT4nICk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdCQoICcubGxtcy1jaGVja291dC13cmFwcGVyJyApLnByZXBlbmQoICRlcnIgKTtcblx0XHRcdFx0XHRcdCQoICdodG1sLCBib2R5JyApLmFuaW1hdGUoIHtcblx0XHRcdFx0XHRcdFx0c2Nyb2xsVG9wOiAkZXJyLm9mZnNldCgpLnRvcCAtIDUwLFxuXHRcdFx0XHRcdFx0fSwgMjAwICk7XG5cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggY2xlYXIgKSB7XG5cdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbCggaW50ZXJ2YWwgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc3RvcCApIHtcblx0XHRcdFx0XHRzZWxmLnByb2Nlc3NpbmcoICdzdG9wJyApO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRjaGVja3MrKztcblxuXHRcdFx0fSwgMTAwICk7XG5cblx0XHR9O1xuXG5cdFx0Ly8gaW5pdGFsaXplXG5cdFx0dGhpcy5pbml0KCk7XG5cblx0XHRyZXR1cm4gdGhpcztcblxuXHR9O1xuXG5cdHdpbmRvdy5sbG1zID0gd2luZG93LmxsbXMgfHwge307XG5cdHdpbmRvdy5sbG1zLmNoZWNrb3V0ID0gbmV3IGxsbXNfY2hlY2tvdXQoKTtcblxufSApKCBqUXVlcnkgKTtcbiJdfQ==
