!function(l){window.llms=window.llms||{};window.llms.analytics=new function(){return this.charts_loaded=!1,this.data={},this.query=l.parseJSON(l("#llms-analytics-json").text()),this.timeout=8e3,this.$widgets=l(".llms-widget[data-method]"),this.init=function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(this.charts_ready),this.bind(),this.load_widgets()},this.bind=function(){l(".llms-datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:0}),l("#llms-students-ids-filter").llmsStudentsSelect2({multiple:!0,placeholder:LLMS.l10n.translate("Filter by Student(s)")}),l('a[href="#llms-toggle-filters"]').on("click",function(t){t.preventDefault(),l(".llms-analytics-filters").slideToggle(100)}),l("#llms-custom-date-submit").on("click",function(){l('input[name="range"]').val("custom")}),l("#llms-date-quick-filters a.llms-nav-link[data-range]").on("click",function(t){t.preventDefault(),l('input[name="range"]').val(l(this).attr("data-range")),l("form.llms-reporting-nav").submit()})},this.charts_ready=function(){window.llms.analytics.charts_loaded=!0,window.llms.analytics.draw_chart()},this.draw_chart=function(){if(this.charts_loaded&&this.is_loading_finished()){var t=document.getElementById("llms-charts-wrapper");if(t){var a=new google.visualization.ComboChart(t),e=this.get_chart_data(),i={chartArea:{height:"75%",width:"85%"},colors:["#606C38","#E85D75","#EF8354","#C64191","#731963"],height:560,lineWidth:4,seriesType:"bars",series:this.get_chart_series_options(),vAxes:{0:{format:"currency"},1:{format:""}}};e.length&&((e=google.visualization.arrayToDataTable(e)).sort([{column:0}]),a.draw(e,i))}}},this.is_loading_finished=function(){return!l(".llms-widget.is-loading").length},this.load_widgets=function(){var t=this;this.$widgets.each(function(){t.load_widget(l(this))})},this.load_widget=function(a){var e,i=this,s=a.attr("data-method"),r=a.find("h1"),n=a.find(".llms-reload-widget"),d=LLMS.l10n.translate("Error");a.addClass("is-loading"),l.ajax({data:{action:"llms_widget_"+s,dates:i.query.dates,courses:i.query.current_courses,memberships:i.query.current_memberships,students:i.query.current_students},method:"POST",timeout:i.timeout,url:window.ajaxurl,success:function(t){e="success",void 0!==t.response&&(d=t.response,i.data[s]={chart_data:t.chart_data,response:t.response,results:t.results},n.remove())},error:function(t){e="error"},complete:function(t){"error"===e&&(d="timeout"===t.statusText?LLMS.l10n.translate("Request timed out"):LLMS.l10n.translate("Error"),n.length||((n=l('<a class="llms-reload-widget" href="#">'+LLMS.l10n.translate("Retry")+"</a>")).on("click",function(t){t.preventDefault(),i.load_widget(a)}),a.append(n))),a.removeClass("is-loading"),r.html(d),i.widget_finished(a)}})},this.get_date_diff=function(){var t=new Date(this.query.dates.end),a=new Date(this.query.dates.start);return Math.abs(t.getTime()-a.getTime())},this.get_chart_data_object=function(){var t,a,e,i,s=this,r=this.get_date_diff(),n={};for(var d in s.data)if(s.data.hasOwnProperty(d)&&"object"==typeof s.data[d].chart_data&&"object"==typeof s.data[d].results&&(t=s.data[d].results))for(a=0;a<t.length;a++)switch(e=this.init_date(t[a].date),n[i=r<=10368e6?new Date(e.getFullYear(),e.getMonth(),e.getDate()):new Date(e.getFullYear(),e.getMonth(),1)]||(n[i]=this.get_empty_data_object(i)),s.data[d].chart_data.type){case"amount":n[i][d]=n[i][d]+1*t[a][s.data[d].chart_data.key];break;case"count":default:n[i][d]++}return n},this.get_chart_data=function(){var t=this.get_chart_data_object(),a=this.get_chart_headers();for(var e in t)if(t.hasOwnProperty(e)){var i=[t[e]._date];for(var s in t[e])t[e].hasOwnProperty(s)&&0!==s.indexOf("_")&&i.push(t[e][s]);a.push(i)}return a},this.get_empty_data_object=function(t){var a=this,e={_date:t};for(var i in a.data)a.data.hasOwnProperty(i)&&a.data[i].chart_data&&(e[i]=0);return e},this.get_chart_headers=function(){var t=this,a=[];for(var e in a.push({label:LLMS.l10n.translate("Date"),id:"date",type:"date"}),t.data)t.data.hasOwnProperty(e)&&t.data[e].chart_data&&a.push(t.data[e].chart_data.header);return[a]},this.get_chart_series_options=function(){var t=this,a={};for(var e in i=0,t.data)if(t.data.hasOwnProperty(e)&&t.data[e].chart_data){var s=t.data[e].chart_data.type;a[i]={type:"count"===s?"bars":"line",targetAxisIndex:"count"===s?1:0},i++}return a},this.init_date=function(t){var a,e,i;return e=(a=t.split(" "))[0].split("-"),i=a[1].split(":"),new Date(e[0],e[1]-1,e[2],i[0],i[1],i[2])},this.widget_finished=function(t){this.is_loading_finished()&&this.draw_chart()},this.init(),this}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtYW5hbHl0aWNzLmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwiYW5hbHl0aWNzIiwidGhpcyIsImNoYXJ0c19sb2FkZWQiLCJkYXRhIiwicXVlcnkiLCJwYXJzZUpTT04iLCJ0ZXh0IiwidGltZW91dCIsIiR3aWRnZXRzIiwiaW5pdCIsImdvb2dsZSIsImNoYXJ0cyIsImxvYWQiLCJwYWNrYWdlcyIsInNldE9uTG9hZENhbGxiYWNrIiwiY2hhcnRzX3JlYWR5IiwiYmluZCIsImxvYWRfd2lkZ2V0cyIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwibWF4RGF0ZSIsImxsbXNTdHVkZW50c1NlbGVjdDIiLCJtdWx0aXBsZSIsInBsYWNlaG9sZGVyIiwiTExNUyIsImwxMG4iLCJ0cmFuc2xhdGUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlVG9nZ2xlIiwidmFsIiwiYXR0ciIsInN1Ym1pdCIsImRyYXdfY2hhcnQiLCJpc19sb2FkaW5nX2ZpbmlzaGVkIiwiZWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2hhcnQiLCJ2aXN1YWxpemF0aW9uIiwiQ29tYm9DaGFydCIsImdldF9jaGFydF9kYXRhIiwib3B0aW9ucyIsImNoYXJ0QXJlYSIsImhlaWdodCIsIndpZHRoIiwiY29sb3JzIiwibGluZVdpZHRoIiwic2VyaWVzVHlwZSIsInNlcmllcyIsImdldF9jaGFydF9zZXJpZXNfb3B0aW9ucyIsInZBeGVzIiwiMCIsImZvcm1hdCIsIjEiLCJsZW5ndGgiLCJhcnJheVRvRGF0YVRhYmxlIiwic29ydCIsImNvbHVtbiIsImRyYXciLCJzZWxmIiwiZWFjaCIsImxvYWRfd2lkZ2V0IiwiJHdpZGdldCIsInN0YXR1cyIsIm1ldGhvZCIsIiRjb250ZW50IiwiZmluZCIsIiRyZXRyeSIsImNvbnRlbnRfdGV4dCIsImFkZENsYXNzIiwiYWpheCIsImFjdGlvbiIsImRhdGVzIiwiY291cnNlcyIsImN1cnJlbnRfY291cnNlcyIsIm1lbWJlcnNoaXBzIiwiY3VycmVudF9tZW1iZXJzaGlwcyIsInN0dWRlbnRzIiwiY3VycmVudF9zdHVkZW50cyIsInVybCIsImFqYXh1cmwiLCJzdWNjZXNzIiwiciIsInJlc3BvbnNlIiwiY2hhcnRfZGF0YSIsInJlc3VsdHMiLCJyZW1vdmUiLCJlcnJvciIsImNvbXBsZXRlIiwic3RhdHVzVGV4dCIsImFwcGVuZCIsInJlbW92ZUNsYXNzIiwiaHRtbCIsIndpZGdldF9maW5pc2hlZCIsImdldF9kYXRlX2RpZmYiLCJlbmQiLCJEYXRlIiwic3RhcnQiLCJNYXRoIiwiYWJzIiwiZ2V0VGltZSIsImdldF9jaGFydF9kYXRhX29iamVjdCIsInJlcyIsImkiLCJkIiwiZGF0ZSIsImRpZmYiLCJoYXNPd25Qcm9wZXJ0eSIsImluaXRfZGF0ZSIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0X2VtcHR5X2RhdGFfb2JqZWN0IiwidHlwZSIsImtleSIsIm9iaiIsImdldF9jaGFydF9oZWFkZXJzIiwicm93IiwiX2RhdGUiLCJpdGVtIiwiaW5kZXhPZiIsInB1c2giLCJoIiwibGFiZWwiLCJpZCIsImhlYWRlciIsInRhcmdldEF4aXNJbmRleCIsInN0cmluZyIsInBhcnRzIiwidGltZSIsInNwbGl0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FPQyxTQUFZQSxHQUVaQyxPQUFPQyxLQUFPRCxPQUFPQyxNQUFRLEdBcWlCN0JELE9BQU9DLEtBQUtDLFVBQVksSUE5aEJSLFdBMGhCZixPQXhoQkFDLEtBQUtDLGVBQWdCLEVBQ3JCRCxLQUFLRSxLQUFPLEdBQ1pGLEtBQUtHLE1BQVFQLEVBQUVRLFVBQVdSLEVBQUcsd0JBQXlCUyxRQUN0REwsS0FBS00sUUFBVSxJQUVmTixLQUFLTyxTQUFXWCxFQUFHLDZCQVFuQkksS0FBS1EsS0FBTyxXQUVYQyxPQUFPQyxPQUFPQyxLQUFNLFVBQVcsQ0FDOUJDLFNBQVUsQ0FDVCxlQUdHSCxPQUFPQyxPQUFPRyxrQkFBbUJiLEtBQUtjLGNBRTND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RCxHQUFTb0IsV0FBV3lDLFFBS3pDLE1BQU8sQ0FBRUgsSUFZVjNILEtBQUtrRCx5QkFBMkIsV0FFL0IsSUFBSVUsRUFBTzVELEtBQ1YwQyxFQUFVLEdBR1gsSUFBTSxJQUFJdUIsS0FGVHVDLEVBQUksRUFFZTVDLEVBQUsxRCxLQUN4QixHQUFPMEQsRUFBSzFELEtBQUswRyxlQUFnQjNDLElBSTVCTCxFQUFLMUQsS0FBTStELEdBQVNvQixXQUFhLENBRXJDLElBQUk2QixFQUFPdEQsRUFBSzFELEtBQU0rRCxHQUFTb0IsV0FBVzZCLEtBRTFDeEUsRUFBUzhELEdBQU0sQ0FDZFUsS0FBUSxVQUFZQSxFQUFTLE9BQVMsT0FDdENhLGdCQUFtQixVQUFZYixFQUFTLEVBQUksR0FHN0NWLElBTUYsT0FBTzlELEdBV1IxQyxLQUFLNkcsVUFBWSxTQUFVbUIsR0FFMUIsSUFBSUMsRUFBT3ZCLEVBQU13QixFQU9qQixPQUhBeEIsR0FGQXVCLEVBQVFELEVBQU9HLE1BQU8sTUFFVCxHQUFHQSxNQUFPLEtBQ3ZCRCxFQUFPRCxFQUFNLEdBQUdFLE1BQU8sS0FFaEIsSUFBSWxDLEtBQU1TLEVBQUssR0FBSUEsRUFBSyxHQUFLLEVBQUdBLEVBQUssR0FBSXdCLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLLEtBWXhFbEksS0FBSzhGLGdCQUFrQixTQUFVL0IsR0FFM0IvRCxLQUFLa0MsdUJBQ1RsQyxLQUFLaUMsY0FNUGpDLEtBQUtRLE9BR0VSLE1BbmlCUixDQXlpQklvSSIsImZpbGUiOiJsbG1zLWFuYWx5dGljcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpZnRlckxNUyBBZG1pbiBSZXBvcnRpbmcgV2lkZ2V0cyAmIENoYXJ0c1xuICpcbiAqIEBzaW5jZSAzLjAuMFxuICogQHNpbmNlIDMuMTcuMiBVbmtub3duLlxuICogQHNpbmNlIDMuMzMuMSBGaXggaXNzdWUgdGhhdCBwcm9kdWNlZCBzZXJpZXMgb3B0aW9ucyBub3QgYWxpZ25lZCB3aXRoIHRoZSBjaGFydCBkYXRhLlxuICovXG47KCBmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkge1xuXG5cdHdpbmRvdy5sbG1zID0gd2luZG93LmxsbXMgfHwge307XG5cblx0LyoqXG5cdCAqIExpZnRlckxNUyBBZG1pbiBBbmFseXRpY3Ncblx0ICogQHNpbmNlICAgIDMuMC4wXG5cdCAqIEB2ZXJzaW9uICAzLjUuMFxuXHQgKi9cblx0dmFyIEFuYWx5dGljcyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0dGhpcy5jaGFydHNfbG9hZGVkID0gZmFsc2U7XG5cdFx0dGhpcy5kYXRhID0ge307XG5cdFx0dGhpcy5xdWVyeSA9ICQucGFyc2VKU09OKCAkKCAnI2xsbXMtYW5hbHl0aWNzLWpzb24nICkudGV4dCgpICk7XG5cdFx0dGhpcy50aW1lb3V0ID0gODAwMDtcblxuXHRcdHRoaXMuJHdpZGdldHMgPSAkKCAnLmxsbXMtd2lkZ2V0W2RhdGEtbWV0aG9kXScgKTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVyXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmluaXQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0Z29vZ2xlLmNoYXJ0cy5sb2FkKCAnY3VycmVudCcsIHtcblx0XHRcdFx0cGFja2FnZXM6IFtcblx0XHRcdFx0XHQnY29yZWNoYXJ0J1xuXHRcdFx0XHRdXG5cdFx0XHR9ICk7XG4gICAgICBcdFx0Z29vZ2xlLmNoYXJ0cy5zZXRPbkxvYWRDYWxsYmFjayggdGhpcy5jaGFydHNfcmVhZHkgKTtcblxuXHRcdFx0dGhpcy5iaW5kKCk7XG5cdFx0XHR0aGlzLmxvYWRfd2lkZ2V0cygpO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgRE9NIGV2ZW50c1xuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdCQoICcubGxtcy1kYXRlcGlja2VyJyApLmRhdGVwaWNrZXIoIHtcblx0XHRcdFx0ZGF0ZUZvcm1hdDogJ3l5LW1tLWRkJyxcblx0XHRcdFx0bWF4RGF0ZTogMCxcblx0XHRcdH0gKTtcblxuXG5cdFx0XHQkKCAnI2xsbXMtc3R1ZGVudHMtaWRzLWZpbHRlcicgKS5sbG1zU3R1ZGVudHNTZWxlY3QyKCB7XG5cdFx0XHRcdG11bHRpcGxlOiB0cnVlLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjogTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0ZpbHRlciBieSBTdHVkZW50KHMpJyApLFxuXHRcdFx0fSApO1xuXG5cdFx0XHQkKCAnYVtocmVmPVwiI2xsbXMtdG9nZ2xlLWZpbHRlcnNcIl0nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoICcubGxtcy1hbmFseXRpY3MtZmlsdGVycycgKS5zbGlkZVRvZ2dsZSggMTAwICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCQoICcjbGxtcy1jdXN0b20tZGF0ZS1zdWJtaXQnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCAnaW5wdXRbbmFtZT1cInJhbmdlXCJdJyApLnZhbCggJ2N1c3RvbScgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJyNsbG1zLWRhdGUtcXVpY2stZmlsdGVycyBhLmxsbXMtbmF2LWxpbmtbZGF0YS1yYW5nZV0nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JCggJ2lucHV0W25hbWU9XCJyYW5nZVwiXScgKS52YWwoICQoIHRoaXMgKS5hdHRyKCAnZGF0YS1yYW5nZScgKSApO1xuXG5cdFx0XHRcdCQoICdmb3JtLmxsbXMtcmVwb3J0aW5nLW5hdicgKS5zdWJtaXQoKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCAgYnkgR29vZ2xlIENoYXJ0cyB3aGVuIHRoZSBsaWJyYXJ5IGlzIGxvYWRlZCBhbmQgcmVhZHlcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuY2hhcnRzX3JlYWR5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5jaGFydHNfbG9hZGVkID0gdHJ1ZTtcblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5kcmF3X2NoYXJ0KCk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVyIHRoZSBjaGFydFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMTcuNlxuXHRcdCAqL1xuXHRcdHRoaXMuZHJhd19jaGFydCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRpZiAoICEgdGhpcy5jaGFydHNfbG9hZGVkIHx8ICEgdGhpcy5pc19sb2FkaW5nX2ZpbmlzaGVkKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdsbG1zLWNoYXJ0cy13cmFwcGVyJyApO1xuXG5cdFx0XHRpZiAoICEgZWwgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRjaGFydCA9IG5ldyBnb29nbGUudmlzdWFsaXphdGlvbi5Db21ib0NoYXJ0KCBlbCApLFxuXHRcdFx0XHRkYXRhID0gc2VsZi5nZXRfY2hhcnRfZGF0YSgpLFxuXHRcdFx0XHRvcHRpb25zID0ge1xuXHRcdFx0XHRcdGNoYXJ0QXJlYToge1xuXHRcdFx0XHRcdFx0aGVpZ2h0OiAnNzUlJyxcblx0XHRcdFx0XHRcdHdpZHRoOiAnODUlJyxcblx0XHRcdFx0XHRcdC8vIGJvdHRvbTogMjAsXG5cdFx0XHRcdFx0XHQvLyBsZWZ0OiAyMCxcblx0XHRcdFx0XHRcdC8vIHJpZ2h0OiAyMCxcblx0XHRcdFx0XHRcdC8vIHRvcDogMjAsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjb2xvcnM6IFsnIzYwNkMzOCcsJyNFODVENzUnLCcjRUY4MzU0JywnI0M2NDE5MScsJyM3MzE5NjMnXSxcblx0XHRcdFx0XHRoZWlnaHQ6IDU2MCxcblx0XHRcdFx0XHRsaW5lV2lkdGg6IDQsXG5cdFx0XHRcdFx0c2VyaWVzVHlwZTogJ2JhcnMnLFxuXHRcdFx0XHRcdHNlcmllczogc2VsZi5nZXRfY2hhcnRfc2VyaWVzX29wdGlvbnMoKSxcblx0XHRcdFx0XHR2QXhlczoge1xuXHRcdFx0XHRcdFx0MDoge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQ6ICdjdXJyZW5jeScsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0MToge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQ6ICcnLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXHRcdFx0XHQvLyBkYXRhID0gZ29vZ2xlLnZpc3VhbGl6YXRpb24uYXJyYXlUb0RhdGFUYWJsZSggW1xuXHRcdFx0XHQvLyBcdC8vIFsnTW9udGgnLCAnQm9saXZpYScsICdFY3VhZG9yJywgJ01hZGFnYXNjYXInLCAnUGFwdWEgTmV3IEd1aW5lYScsICdSd2FuZGEnLCAnQXZlcmFnZSddLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwNC8wNScsICAxNjUsICAgICAgOTM4LCAgICAgICAgIDUyMiwgICAgICAgICAgICAgOTk4LCAgICAgICAgICAgNDUwLCAgICAgIDYxNC42XSxcblx0XHRcdFx0Ly8gXHQvLyBbJzIwMDUvMDYnLCAgMTM1LCAgICAgIDExMjAsICAgICAgICA1OTksICAgICAgICAgICAgIDEyNjgsICAgICAgICAgIDI4OCwgICAgICA2ODJdLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwNi8wNycsICAxNTcsICAgICAgMTE2NywgICAgICAgIDU4NywgICAgICAgICAgICAgODA3LCAgICAgICAgICAgMzk3LCAgICAgIDYyM10sXG5cdFx0XHRcdC8vIFx0Ly8gWycyMDA3LzA4JywgIDEzOSwgICAgICAxMTEwLCAgICAgICAgNjE1LCAgICAgICAgICAgICA5NjgsICAgICAgICAgICAyMTUsICAgICAgNjA5LjRdLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwOC8wOScsICAxMzYsICAgICAgNjkxLCAgICAgICAgIDYyOSwgICAgICAgICAgICAgMTAyNiwgICAgICAgICAgMzY2LCAgICAgIDU2OS42XVxuXHRcdFx0XHQvLyBdIClcblxuXHRcdFx0aWYgKCBkYXRhLmxlbmd0aCApIHtcblxuXHRcdFx0XHRkYXRhID0gZ29vZ2xlLnZpc3VhbGl6YXRpb24uYXJyYXlUb0RhdGFUYWJsZSggZGF0YSApO1xuXHRcdFx0XHRkYXRhLnNvcnQoW3tjb2x1bW46IDB9XSk7XG5cdFx0XHRcdGNoYXJ0LmRyYXcoIGRhdGEsIG9wdGlvbnMgKTtcblxuXHRcdFx0fVxuXG5cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDaGVjayBpZiBhIHdpZGdldCBpcyBzdGlsbCBsb2FkaW5nXG5cdFx0ICogQHJldHVybiAgIGJvb2xcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmlzX2xvYWRpbmdfZmluaXNoZWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdGlmICggJCggJy5sbG1zLXdpZGdldC5pcy1sb2FkaW5nJyApLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFN0YXJ0IGxvYWRpbmcgYWxsIHdpZGdldHMgb24gdGhlIGN1cnJlbnQgc2NyZWVuXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmxvYWRfd2lkZ2V0cyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMuJHdpZGdldHMuZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0c2VsZi5sb2FkX3dpZGdldCggJCggdGhpcyApICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBMb2FkIGEgc3BlY2lmaWMgd2lkZ2V0XG5cdFx0ICogQHBhcmFtICAgIG9iaiAgICR3aWRnZXQgIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgd2lkZ2V0IGVsZW1lbnRcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjE2Ljhcblx0XHQgKi9cblx0XHR0aGlzLmxvYWRfd2lkZ2V0ID0gZnVuY3Rpb24oICR3aWRnZXQgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0bWV0aG9kID0gJHdpZGdldC5hdHRyKCAnZGF0YS1tZXRob2QnICksXG5cdFx0XHRcdCRjb250ZW50ID0gJHdpZGdldC5maW5kKCAnaDEnICksXG5cdFx0XHRcdCRyZXRyeSA9ICR3aWRnZXQuZmluZCggJy5sbG1zLXJlbG9hZC13aWRnZXQnICksXG5cdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKSxcblx0XHRcdFx0c3RhdHVzO1xuXG5cdFx0XHQkd2lkZ2V0LmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuXHRcdFx0JC5hamF4KCB7XG5cblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ2xsbXNfd2lkZ2V0XycgKyBtZXRob2QsXG5cdFx0XHRcdFx0ZGF0ZXM6IHNlbGYucXVlcnkuZGF0ZXMsXG5cdFx0XHRcdFx0Y291cnNlczogc2VsZi5xdWVyeS5jdXJyZW50X2NvdXJzZXMsXG5cdFx0XHRcdFx0bWVtYmVyc2hpcHM6IHNlbGYucXVlcnkuY3VycmVudF9tZW1iZXJzaGlwcyxcblx0XHRcdFx0XHRzdHVkZW50czogc2VsZi5xdWVyeS5jdXJyZW50X3N0dWRlbnRzLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0dGltZW91dDogc2VsZi50aW1lb3V0LFxuXHRcdFx0XHR1cmw6IHdpbmRvdy5hamF4dXJsLFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdHN0YXR1cyA9ICdzdWNjZXNzJztcblxuXHRcdFx0XHRcdGlmKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIHIucmVzcG9uc2UgKSB7XG5cblx0XHRcdFx0XHRcdGNvbnRlbnRfdGV4dCA9IHIucmVzcG9uc2U7XG5cblx0XHRcdFx0XHRcdHNlbGYuZGF0YVttZXRob2RdID0ge1xuXHRcdFx0XHRcdFx0XHRjaGFydF9kYXRhOiByLmNoYXJ0X2RhdGEsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByLnJlc3BvbnNlLFxuXHRcdFx0XHRcdFx0XHRyZXN1bHRzOiByLnJlc3VsdHMsXG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHQkcmV0cnkucmVtb3ZlKCk7XG5cblx0XHRcdFx0XHR9XG5cblxuXHRcdFx0XHR9LFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIHIgKSB7XG5cblx0XHRcdFx0XHRzdGF0dXMgPSAnZXJyb3InO1xuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdGlmICggJ2Vycm9yJyA9PT0gc3RhdHVzICkge1xuXG5cdFx0XHRcdFx0XHRpZiggJ3RpbWVvdXQnID09PSByLnN0YXR1c1RleHQgKSB7XG5cblx0XHRcdFx0XHRcdFx0Y29udGVudF90ZXh0ID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ1JlcXVlc3QgdGltZWQgb3V0JyApO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoICEgJHJldHJ5Lmxlbmd0aCApIHtcblxuXHRcdFx0XHRcdFx0XHQkcmV0cnkgPSAkKCAnPGEgY2xhc3M9XCJsbG1zLXJlbG9hZC13aWRnZXRcIiBocmVmPVwiI1wiPicgKyBMTE1TLmwxMG4udHJhbnNsYXRlKCAnUmV0cnknICkgKyAnPC9hPicgKTtcblx0XHRcdFx0XHRcdFx0JHJldHJ5Lm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmxvYWRfd2lkZ2V0KCAkd2lkZ2V0ICk7XG5cblx0XHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0XHRcdCR3aWRnZXQuYXBwZW5kKCAkcmV0cnkgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0JHdpZGdldC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cdFx0XHRcdFx0JGNvbnRlbnQuaHRtbCggY29udGVudF90ZXh0ICk7XG5cblx0XHRcdFx0XHRzZWxmLndpZGdldF9maW5pc2hlZCggJHdpZGdldCApO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEdldCB0aGUgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gdGhlIHF1ZXJpZWQgZGF0ZXNcblx0XHQgKiBAcmV0dXJuICAgaW50XG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfZGF0ZV9kaWZmID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBlbmQgPSBuZXcgRGF0ZSggdGhpcy5xdWVyeS5kYXRlcy5lbmQgKSxcblx0XHRcdFx0c3RhcnQgPSBuZXcgRGF0ZSggdGhpcy5xdWVyeS5kYXRlcy5zdGFydCApO1xuXG5cdFx0XHRyZXR1cm4gTWF0aC5hYnMoIGVuZC5nZXRUaW1lKCkgLSBzdGFydC5nZXRUaW1lKCkgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCdWlsZHMgYW4gb2JqZWN0IG9mIGRhdGEgdGhhdCBjYW4gYmUgdXNlZCB0bywgdWx0aW1hdGVseSwgZHJhdyB0aGUgc2NyZWVuJ3MgY2hhcnRcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMS42XG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfZGF0YV9vYmplY3QgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtYXhfZm9yX2RheXMgPSAoICggMTAwMCAqIDM2MDAgKiAyNCApICogMzAgKSAqIDQsIC8vIDQgbW9udGhzIGluIHNlY29uZHNcblx0XHRcdFx0ZGlmZiA9IHRoaXMuZ2V0X2RhdGVfZGlmZigpLFxuXHRcdFx0XHRkYXRhID0ge30sXG5cdFx0XHRcdHJlcywgaSwgZCwgZGF0ZTtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhIHx8ICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzID0gc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzO1xuXG5cdFx0XHRcdGlmICggcmVzICkge1xuXG5cdFx0XHRcdFx0Zm9yICggaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKysgKSB7XG5cblx0XHRcdFx0XHRcdGQgPSB0aGlzLmluaXRfZGF0ZSggcmVzW2ldLmRhdGUgKTtcblxuXHRcdFx0XHRcdFx0Ly8gZ3JvdXAgYnkgZGF5c1xuXHRcdFx0XHRcdFx0aWYgKCBkaWZmIDw9IG1heF9mb3JfZGF5cyApIHtcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IG5ldyBEYXRlKCBkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8vIGdyb3VwIGJ5IG1vbnRoc1xuXHRcdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGRhdGUgPSBuZXcgRGF0ZSggZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIDEgKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCAhIGRhdGFbIGRhdGUgXSApIHtcblx0XHRcdFx0XHRcdFx0ZGF0YVsgZGF0ZSBdID0gdGhpcy5nZXRfZW1wdHlfZGF0YV9vYmplY3QoIGRhdGUgKVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzd2l0Y2ggKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEudHlwZSApIHtcblxuXHRcdFx0XHRcdFx0XHRjYXNlICdhbW91bnQnOlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0gPSBkYXRhWyBkYXRlIF1bIG1ldGhvZCBdICsgKCByZXNbaV1bIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS5rZXkgXSAqIDEgKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSAnY291bnQnOlxuXHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0rKztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IHRoZSBkYXRhIGdvb2dsZSBjaGFydHMgbmVlZHMgdG8gaW5pdGlhdGUgdGhlIGN1cnJlbnQgY2hhcnRcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfZGF0YSA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG9iaiA9IHNlbGYuZ2V0X2NoYXJ0X2RhdGFfb2JqZWN0KCksXG5cdFx0XHRcdGRhdGEgPSBzZWxmLmdldF9jaGFydF9oZWFkZXJzKCk7XG5cblx0XHRcdGZvciAoIHZhciBkYXRlIGluIG9iaiApIHtcblxuXHRcdFx0XHRpZiAoICEgb2JqLmhhc093blByb3BlcnR5KCBkYXRlICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgcm93ID0gWyBvYmpbIGRhdGUgXS5fZGF0ZSBdO1xuXG5cdFx0XHRcdGZvciAoIHZhciBpdGVtIGluIG9ialsgZGF0ZSBdICkge1xuXHRcdFx0XHRcdGlmICggISBvYmpbIGRhdGUgXS5oYXNPd25Qcm9wZXJ0eSggaXRlbSApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gc2tpcCBtZXRhIGl0ZW1zXG5cdFx0XHRcdFx0aWYgKCAwID09PSBpdGVtLmluZGV4T2YoICdfJyApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cm93LnB1c2goIG9ialsgZGF0ZSBdWyBpdGVtIF0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRhdGEucHVzaCggcm93ICk7XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IGEgc3R1YiBvZiB0aGUgZGF0YSBvYmplY3QgdXNlZCBieSB0aGlzLmdldF9kYXRhX29iamVjdFxuXHRcdCAqIEBwYXJhbSAgICBzdHJpbmcgICBkYXRlICBkYXRlIHRvIGluc3RhbnRpYXRlIHRoZSBvYmplY3Qgd2l0aFxuXHRcdCAqIEByZXR1cm4gICBvYmpcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9lbXB0eV9kYXRhX29iamVjdCA9IGZ1bmN0aW9uKCBkYXRlICkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG9iaiA9IHtcblx0XHRcdFx0XHRfZGF0ZTogZGF0ZSxcblx0XHRcdFx0fTtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cdFx0XHRcdGlmICggISBzZWxmLmRhdGEuaGFzT3duUHJvcGVydHkoIG1ldGhvZCApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEgKSB7XG5cdFx0XHRcdFx0b2JqWyBtZXRob2QgXSA9IDA7XG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb2JqO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJ1aWxkcyBhbiBhcnJheSBvZiBjaGFydCBoZWFkZXIgZGF0YVxuXHRcdCAqIEByZXR1cm4gICBhcnJheVxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X2NoYXJ0X2hlYWRlcnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRoID0gW107XG5cblx0XHRcdC8vIGRhdGUgaGVhZGVycyBnbyBmaXJzdFxuXHRcdFx0aC5wdXNoKCB7XG5cdFx0XHRcdGxhYmVsOiBMTE1TLmwxMG4udHJhbnNsYXRlKCAnRGF0ZScgKSxcblx0XHRcdFx0aWQ6ICdkYXRlJyxcblx0XHRcdFx0dHlwZTogJ2RhdGUnLFxuXHRcdFx0fSApO1xuXG5cblx0XHRcdGZvciAoIHZhciBtZXRob2QgaW4gc2VsZi5kYXRhICkge1xuXHRcdFx0XHRpZiAoICEgc2VsZi5kYXRhLmhhc093blByb3BlcnR5KCBtZXRob2QgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhICkge1xuXHRcdFx0XHRcdGgucHVzaCggc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhLmhlYWRlciApO1xuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIFsgaCBdO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEdldCBhIG9iamVjdCBvZiBzZXJpZXMgb3B0aW9ucyBuZWVkZWQgdG8gZHJhdyB0aGUgY2hhcnQuXG5cdFx0ICpcblx0XHQgKiBAc2luY2UgMy4wLjBcblx0XHQgKiBAc2luY2UgRml4IGlzc3VlIHRoYXQgcHJvZHVjZWQgc2VyaWVzIG9wdGlvbnMgbm90IGFsaWduZWQgd2l0aCB0aGUgY2hhcnQgZGF0YS5cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X2NoYXJ0X3Nlcmllc19vcHRpb25zID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0b3B0aW9ucyA9IHt9XG5cdFx0XHRcdGkgPSAwO1xuXG5cdFx0XHRmb3IgKCB2YXIgbWV0aG9kIGluIHNlbGYuZGF0YSApIHtcblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YSApIHtcblxuXHRcdFx0XHRcdHZhciB0eXBlID0gc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhLnR5cGU7XG5cblx0XHRcdFx0XHRvcHRpb25zWyBpIF0gPSB7XG5cdFx0XHRcdFx0XHR0eXBlOiAoICdjb3VudCcgPT09IHR5cGUgKSA/ICdiYXJzJyA6ICdsaW5lJyxcblx0XHRcdFx0XHRcdHRhcmdldEF4aXNJbmRleDogKCAnY291bnQnID09PSB0eXBlICkgPyAxIDogMCxcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0aSsrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3B0aW9ucztcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbnN0YW50aWF0ZSBhIERhdGUgaW5zdGFuY2UgdmlhIGEgZGF0ZSBzdHJpbmdcblx0XHQgKiBAcGFyYW0gICAgc3RyaW5nICAgc3RyaW5nICBkYXRlIHN0cmluZywgZXhwZWN0ZWQgZm9ybWF0IHNob3VsZCBiZSBmcm9tIHBocCBkYXRlKCAnWS1tLWQgSDppOnMnIClcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMS40XG5cdFx0ICogQHZlcnNpb24gIDMuMS41XG5cdFx0ICovXG5cdFx0dGhpcy5pbml0X2RhdGUgPSBmdW5jdGlvbiggc3RyaW5nICkge1xuXG5cdFx0XHR2YXIgcGFydHMsIGRhdGUsIHRpbWU7XG5cblx0XHRcdHBhcnRzID0gc3RyaW5nLnNwbGl0KCAnICcgKTtcblxuXHRcdFx0ZGF0ZSA9IHBhcnRzWzBdLnNwbGl0KCAnLScgKTtcblx0XHRcdHRpbWUgPSBwYXJ0c1sxXS5zcGxpdCggJzonICk7XG5cblx0XHRcdHJldHVybiBuZXcgRGF0ZSggZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIHRpbWVbMF0sIHRpbWVbMV0sIHRpbWVbMl0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgd2hlbiBhIHdpZGdldCBpcyBmaW5pc2hlZCBsb2FkaW5nXG5cdFx0ICogVXBkYXRlcyB0aGUgY3VycmVudCBjaGFydCB3aXRoIHRoZSBuZXcgZGF0YSBmcm9tIHRoZSB3aWRnZXRcblx0XHQgKiBAcGFyYW0gICAgb2JqICAgJHdpZGdldCAgalF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSB3aWRnZXQgZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy53aWRnZXRfZmluaXNoZWQgPSBmdW5jdGlvbiggJHdpZGdldCApIHtcblxuXHRcdFx0aWYgKCB0aGlzLmlzX2xvYWRpbmdfZmluaXNoZWQoKSApIHtcblx0XHRcdFx0dGhpcy5kcmF3X2NoYXJ0KCk7XG5cdFx0XHR9XG5cblx0XHR9O1xuXG5cdFx0Ly8gZ29cblx0XHR0aGlzLmluaXQoKTtcblxuXHRcdC8vIHJldHVyblxuXHRcdHJldHVybiB0aGlzO1xuXG5cdH07XG5cblx0d2luZG93LmxsbXMuYW5hbHl0aWNzID0gbmV3IEFuYWx5dGljcygpO1xuXG59ICkoIGpRdWVyeSApO1xuIl19
