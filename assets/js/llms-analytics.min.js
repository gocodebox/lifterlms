!function(l){window.llms=window.llms||{};window.llms.analytics=new function(){return this.charts_loaded=!1,this.data={},this.query=l.parseJSON(l("#llms-analytics-json").text()),this.timeout=8e3,this.$widgets=l(".llms-widget[data-method]"),this.init=function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(this.charts_ready),this.bind(),this.load_widgets()},this.bind=function(){l(".llms-datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:0}),l("#llms-students-ids-filter").llmsStudentsSelect2({multiple:!0,placeholder:LLMS.l10n.translate("Filter by Student(s)")}),l('a[href="#llms-toggle-filters"]').on("click",function(t){t.preventDefault(),l(".llms-analytics-filters").slideToggle(100)}),l("#llms-custom-date-submit").on("click",function(){l('input[name="range"]').val("custom")}),l("#llms-date-quick-filters a.llms-nav-link[data-range]").on("click",function(t){t.preventDefault(),l('input[name="range"]').val(l(this).attr("data-range")),l("form.llms-reporting-nav").submit()})},this.charts_ready=function(){window.llms.analytics.charts_loaded=!0,window.llms.analytics.draw_chart()},this.draw_chart=function(){if(this.charts_loaded&&this.is_loading_finished()){var t=document.getElementById("llms-charts-wrapper");if(t){var a=new google.visualization.ComboChart(t),e=this.get_chart_data(),i={chartArea:{height:"75%",width:"85%"},colors:["#606C38","#E85D75","#EF8354","#C64191","#731963"],height:560,lineWidth:4,seriesType:"bars",series:this.get_chart_series_options(),vAxes:{0:{format:"currency"},1:{format:""}}};e.length&&((e=google.visualization.arrayToDataTable(e)).sort([{column:0}]),a.draw(e,i))}}},this.is_loading_finished=function(){return!l(".llms-widget.is-loading").length},this.load_widgets=function(){var t=this;this.$widgets.each(function(){t.load_widget(l(this))})},this.load_widget=function(a){var e,i=this,s=a.attr("data-method"),r=a.find("h1"),n=a.find(".llms-reload-widget"),d=LLMS.l10n.translate("Error");a.addClass("is-loading"),l.ajax({data:{action:"llms_widget_"+s,dates:i.query.dates,courses:i.query.current_courses,memberships:i.query.current_memberships,students:i.query.current_students},method:"POST",timeout:i.timeout,url:window.ajaxurl,success:function(t){e="success",void 0!==t.response&&(d=t.response,i.data[s]={chart_data:t.chart_data,response:t.response,results:t.results},n.remove())},error:function(t){e="error"},complete:function(t){"error"===e&&(d="timeout"===t.statusText?LLMS.l10n.translate("Request timed out"):LLMS.l10n.translate("Error"),n.length||((n=l('<a class="llms-reload-widget" href="#">'+LLMS.l10n.translate("Retry")+"</a>")).on("click",function(t){t.preventDefault(),i.load_widget(a)}),a.append(n))),a.removeClass("is-loading"),r.html(d),i.widget_finished(a)}})},this.get_date_diff=function(){var t=new Date(this.query.dates.end),a=new Date(this.query.dates.start);return Math.abs(t.getTime()-a.getTime())},this.get_chart_data_object=function(){var t,a,e,i,s=this,r=this.get_date_diff(),n={};for(var d in s.data)if(s.data.hasOwnProperty(d)&&"object"==typeof s.data[d].chart_data&&"object"==typeof s.data[d].results&&(t=s.data[d].results))for(a=0;a<t.length;a++)switch(e=this.init_date(t[a].date),n[i=r<=10368e6?new Date(e.getFullYear(),e.getMonth(),e.getDate()):new Date(e.getFullYear(),e.getMonth(),1)]||(n[i]=this.get_empty_data_object(i)),s.data[d].chart_data.type){case"amount":n[i][d]=n[i][d]+1*t[a][s.data[d].chart_data.key];break;case"count":default:n[i][d]++}return n},this.get_chart_data=function(){var t=this.get_chart_data_object(),a=this.get_chart_headers();for(var e in t)if(t.hasOwnProperty(e)){var i=[t[e]._date];for(var s in t[e])t[e].hasOwnProperty(s)&&0!==s.indexOf("_")&&i.push(t[e][s]);a.push(i)}return a},this.get_empty_data_object=function(t){var a=this,e={_date:t};for(var i in a.data)a.data.hasOwnProperty(i)&&a.data[i].chart_data&&(e[i]=0);return e},this.get_chart_headers=function(){var t=this,a=[];for(var e in a.push({label:LLMS.l10n.translate("Date"),id:"date",type:"date"}),t.data)t.data.hasOwnProperty(e)&&t.data[e].chart_data&&a.push(t.data[e].chart_data.header);return[a]},this.get_chart_series_options=function(){var t=this,a={};for(var e in i=0,t.data)if(t.data.hasOwnProperty(e)&&t.data[e].chart_data){var s=t.data[e].chart_data.type;a[i]={type:"count"===s?"bars":"line",targetAxisIndex:"count"===s?1:0},i++}return a},this.init_date=function(t){var a,e,i;return e=(a=t.split(" "))[0].split("-"),i=a[1].split(":"),new Date(e[0],e[1]-1,e[2],i[0],i[1],i[2])},this.widget_finished=function(t){this.is_loading_finished()&&this.draw_chart()},this.init(),this}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtYW5hbHl0aWNzLmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwiYW5hbHl0aWNzIiwidGhpcyIsImNoYXJ0c19sb2FkZWQiLCJkYXRhIiwicXVlcnkiLCJwYXJzZUpTT04iLCJ0ZXh0IiwidGltZW91dCIsIiR3aWRnZXRzIiwiaW5pdCIsImdvb2dsZSIsImNoYXJ0cyIsImxvYWQiLCJwYWNrYWdlcyIsInNldE9uTG9hZENhbGxiYWNrIiwiY2hhcnRzX3JlYWR5IiwiYmluZCIsImxvYWRfd2lkZ2V0cyIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwibWF4RGF0ZSIsImxsbXNTdHVkZW50c1NlbGVjdDIiLCJtdWx0aXBsZSIsInBsYWNlaG9sZGVyIiwiTExNUyIsImwxMG4iLCJ0cmFuc2xhdGUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlVG9nZ2xlIiwidmFsIiwiYXR0ciIsInN1Ym1pdCIsImRyYXdfY2hhcnQiLCJpc19sb2FkaW5nX2ZpbmlzaGVkIiwiZWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2hhcnQiLCJ2aXN1YWxpemF0aW9uIiwiQ29tYm9DaGFydCIsImdldF9jaGFydF9kYXRhIiwib3B0aW9ucyIsImNoYXJ0QXJlYSIsImhlaWdodCIsIndpZHRoIiwiY29sb3JzIiwibGluZVdpZHRoIiwic2VyaWVzVHlwZSIsInNlcmllcyIsImdldF9jaGFydF9zZXJpZXNfb3B0aW9ucyIsInZBeGVzIiwiMCIsImZvcm1hdCIsIjEiLCJsZW5ndGgiLCJhcnJheVRvRGF0YVRhYmxlIiwic29ydCIsImNvbHVtbiIsImRyYXciLCJzZWxmIiwiZWFjaCIsImxvYWRfd2lkZ2V0IiwiJHdpZGdldCIsInN0YXR1cyIsIm1ldGhvZCIsIiRjb250ZW50IiwiZmluZCIsIiRyZXRyeSIsImNvbnRlbnRfdGV4dCIsImFkZENsYXNzIiwiYWpheCIsImFjdGlvbiIsImRhdGVzIiwiY291cnNlcyIsImN1cnJlbnRfY291cnNlcyIsIm1lbWJlcnNoaXBzIiwiY3VycmVudF9tZW1iZXJzaGlwcyIsInN0dWRlbnRzIiwiY3VycmVudF9zdHVkZW50cyIsInVybCIsImFqYXh1cmwiLCJzdWNjZXNzIiwiciIsInJlc3BvbnNlIiwiY2hhcnRfZGF0YSIsInJlc3VsdHMiLCJyZW1vdmUiLCJlcnJvciIsImNvbXBsZXRlIiwic3RhdHVzVGV4dCIsImFwcGVuZCIsInJlbW92ZUNsYXNzIiwiaHRtbCIsIndpZGdldF9maW5pc2hlZCIsImdldF9kYXRlX2RpZmYiLCJlbmQiLCJEYXRlIiwic3RhcnQiLCJNYXRoIiwiYWJzIiwiZ2V0VGltZSIsImdldF9jaGFydF9kYXRhX29iamVjdCIsInJlcyIsImkiLCJkIiwiZGF0ZSIsImRpZmYiLCJoYXNPd25Qcm9wZXJ0eSIsImluaXRfZGF0ZSIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0X2VtcHR5X2RhdGFfb2JqZWN0IiwidHlwZSIsImtleSIsIm9iaiIsImdldF9jaGFydF9oZWFkZXJzIiwicm93IiwiX2RhdGUiLCJpdGVtIiwiaW5kZXhPZiIsInB1c2giLCJoIiwibGFiZWwiLCJpZCIsImhlYWRlciIsInRhcmdldEF4aXNJbmRleCIsInN0cmluZyIsInBhcnRzIiwidGltZSIsInNwbGl0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FNRyxTQUFZQSxHQUVkQyxPQUFPQyxLQUFPRCxPQUFPQyxNQUFRLEdBK2lCN0JELE9BQU9DLEtBQUtDLFVBQVksSUF2aUJSLFdBbWlCZixPQWppQkFDLEtBQUtDLGVBQWdCLEVBQ3JCRCxLQUFLRSxLQUFnQixHQUNyQkYsS0FBS0csTUFBZ0JQLEVBQUVRLFVBQVdSLEVBQUcsd0JBQXlCUyxRQUM5REwsS0FBS00sUUFBZ0IsSUFFckJOLEtBQUtPLFNBQVdYLEVBQUcsNkJBU25CSSxLQUFLUSxLQUFPLFdBRVhDLE9BQU9DLE9BQU9DLEtBQU0sVUFBVyxDQUM5QkMsU0FBVSxDQUNULGVBR0ZILE9BQU9DLE9BQU9HLGtCQUFtQmIsS0FBS2Ms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SzFELEtBQU0rRCxHQUFTb0IsV0FBV3lDLFFBS3pDLE1BQU8sQ0FBRUgsSUFZVjNILEtBQUtrRCx5QkFBMkIsV0FFL0IsSUFBSVUsRUFBVTVELEtBQ2IwQyxFQUFVLEdBR1gsSUFBTSxJQUFJdUIsS0FGVHVDLEVBQVUsRUFFUzVDLEVBQUsxRCxLQUN4QixHQUFPMEQsRUFBSzFELEtBQUswRyxlQUFnQjNDLElBSTVCTCxFQUFLMUQsS0FBTStELEdBQVNvQixXQUFhLENBRXJDLElBQUk2QixFQUFPdEQsRUFBSzFELEtBQU0rRCxHQUFTb0IsV0FBVzZCLEtBRTFDeEUsRUFBUzhELEdBQU0sQ0FDZFUsS0FBUSxVQUFZQSxFQUFTLE9BQVMsT0FDdENhLGdCQUFtQixVQUFZYixFQUFTLEVBQUksR0FHN0NWLElBTUYsT0FBTzlELEdBWVIxQyxLQUFLNkcsVUFBWSxTQUFVbUIsR0FFMUIsSUFBSUMsRUFBT3ZCLEVBQU13QixFQU9qQixPQUhBeEIsR0FGQXVCLEVBQVFELEVBQU9HLE1BQU8sTUFFVCxHQUFHQSxNQUFPLEtBQ3ZCRCxFQUFPRCxFQUFNLEdBQUdFLE1BQU8sS0FFaEIsSUFBSWxDLEtBQU1TLEVBQUssR0FBSUEsRUFBSyxHQUFLLEVBQUdBLEVBQUssR0FBSXdCLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLLEtBYXhFbEksS0FBSzhGLGdCQUFrQixTQUFVL0IsR0FFM0IvRCxLQUFLa0MsdUJBQ1RsQyxLQUFLaUMsY0FNUGpDLEtBQUtRLE9BR0VSLE1BN2lCTixDQW1qQkVvSSIsImZpbGUiOiJsbG1zLWFuYWx5dGljcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyI7LyoqXG4gKiBMaWZ0ZXJMTVMgQWRtaW4gUmVwb3J0aW5nIFdpZGdldHMgJiBDaGFydHNcbiAqXG4gKiBAc2luY2UgMy4wLjBcbiAqIEBzaW5jZSAzLjE3LjIgVW5rbm93bi5cbiAqIEBzaW5jZSAzLjMzLjEgRml4IGlzc3VlIHRoYXQgcHJvZHVjZWQgc2VyaWVzIG9wdGlvbnMgbm90IGFsaWduZWQgd2l0aCB0aGUgY2hhcnQgZGF0YS5cbiAqLyggZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHtcblxuXHR3aW5kb3cubGxtcyA9IHdpbmRvdy5sbG1zIHx8IHt9O1xuXG5cdC8qKlxuXHQgKiBMaWZ0ZXJMTVMgQWRtaW4gQW5hbHl0aWNzXG5cdCAqXG5cdCAqIEBzaW5jZSAgICAzLjAuMFxuXHQgKiBAdmVyc2lvbiAgMy41LjBcblx0ICovXG5cdHZhciBBbmFseXRpY3MgPSBmdW5jdGlvbigpIHtcblxuXHRcdHRoaXMuY2hhcnRzX2xvYWRlZCA9IGZhbHNlO1xuXHRcdHRoaXMuZGF0YSAgICAgICAgICA9IHt9O1xuXHRcdHRoaXMucXVlcnkgICAgICAgICA9ICQucGFyc2VKU09OKCAkKCAnI2xsbXMtYW5hbHl0aWNzLWpzb24nICkudGV4dCgpICk7XG5cdFx0dGhpcy50aW1lb3V0ICAgICAgID0gODAwMDtcblxuXHRcdHRoaXMuJHdpZGdldHMgPSAkKCAnLmxsbXMtd2lkZ2V0W2RhdGEtbWV0aG9kXScgKTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVyXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRnb29nbGUuY2hhcnRzLmxvYWQoICdjdXJyZW50Jywge1xuXHRcdFx0XHRwYWNrYWdlczogW1xuXHRcdFx0XHRcdCdjb3JlY2hhcnQnXG5cdFx0XHRcdF1cblx0XHRcdH0gKTtcblx0XHRcdGdvb2dsZS5jaGFydHMuc2V0T25Mb2FkQ2FsbGJhY2soIHRoaXMuY2hhcnRzX3JlYWR5ICk7XG5cblx0XHRcdHRoaXMuYmluZCgpO1xuXHRcdFx0dGhpcy5sb2FkX3dpZGdldHMoKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCaW5kIERPTSBldmVudHNcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdCQoICcubGxtcy1kYXRlcGlja2VyJyApLmRhdGVwaWNrZXIoIHtcblx0XHRcdFx0ZGF0ZUZvcm1hdDogJ3l5LW1tLWRkJyxcblx0XHRcdFx0bWF4RGF0ZTogMCxcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJyNsbG1zLXN0dWRlbnRzLWlkcy1maWx0ZXInICkubGxtc1N0dWRlbnRzU2VsZWN0Migge1xuXHRcdFx0XHRtdWx0aXBsZTogdHJ1ZSxcblx0XHRcdFx0cGxhY2Vob2xkZXI6IExMTVMubDEwbi50cmFuc2xhdGUoICdGaWx0ZXIgYnkgU3R1ZGVudChzKScgKSxcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJ2FbaHJlZj1cIiNsbG1zLXRvZ2dsZS1maWx0ZXJzXCJdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkKCAnLmxsbXMtYW5hbHl0aWNzLWZpbHRlcnMnICkuc2xpZGVUb2dnbGUoIDEwMCApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkKCAnI2xsbXMtY3VzdG9tLWRhdGUtc3VibWl0JyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0JCggJ2lucHV0W25hbWU9XCJyYW5nZVwiXScgKS52YWwoICdjdXN0b20nICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCQoICcjbGxtcy1kYXRlLXF1aWNrLWZpbHRlcnMgYS5sbG1zLW5hdi1saW5rW2RhdGEtcmFuZ2VdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoICdpbnB1dFtuYW1lPVwicmFuZ2VcIl0nICkudmFsKCAkKCB0aGlzICkuYXR0ciggJ2RhdGEtcmFuZ2UnICkgKTtcblxuXHRcdFx0XHQkKCAnZm9ybS5sbG1zLXJlcG9ydGluZy1uYXYnICkuc3VibWl0KCk7XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgIGJ5IEdvb2dsZSBDaGFydHMgd2hlbiB0aGUgbGlicmFyeSBpcyBsb2FkZWQgYW5kIHJlYWR5XG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuY2hhcnRzX3JlYWR5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5jaGFydHNfbG9hZGVkID0gdHJ1ZTtcblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5kcmF3X2NoYXJ0KCk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVyIHRoZSBjaGFydFxuXHRcdCAqXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4xNy42XG5cdFx0ICovXG5cdFx0dGhpcy5kcmF3X2NoYXJ0ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggISB0aGlzLmNoYXJ0c19sb2FkZWQgfHwgISB0aGlzLmlzX2xvYWRpbmdfZmluaXNoZWQoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2xsbXMtY2hhcnRzLXdyYXBwZXInICk7XG5cblx0XHRcdGlmICggISBlbCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgc2VsZiAgICA9IHRoaXMsXG5cdFx0XHRcdGNoYXJ0ICAgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29tYm9DaGFydCggZWwgKSxcblx0XHRcdFx0ZGF0YSAgICA9IHNlbGYuZ2V0X2NoYXJ0X2RhdGEoKSxcblx0XHRcdFx0b3B0aW9ucyA9IHtcblx0XHRcdFx0XHRjaGFydEFyZWE6IHtcblx0XHRcdFx0XHRcdGhlaWdodDogJzc1JScsXG5cdFx0XHRcdFx0XHR3aWR0aDogJzg1JScsXG5cdFx0XHRcdFx0XHQvLyBib3R0b206IDIwLFxuXHRcdFx0XHRcdFx0Ly8gbGVmdDogMjAsXG5cdFx0XHRcdFx0XHQvLyByaWdodDogMjAsXG5cdFx0XHRcdFx0XHQvLyB0b3A6IDIwLFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Y29sb3JzOiBbJyM2MDZDMzgnLCcjRTg1RDc1JywnI0VGODM1NCcsJyNDNjQxOTEnLCcjNzMxOTYzJ10sXG5cdFx0XHRcdFx0aGVpZ2h0OiA1NjAsXG5cdFx0XHRcdFx0bGluZVdpZHRoOiA0LFxuXHRcdFx0XHRcdHNlcmllc1R5cGU6ICdiYXJzJyxcblx0XHRcdFx0XHRzZXJpZXM6IHNlbGYuZ2V0X2NoYXJ0X3Nlcmllc19vcHRpb25zKCksXG5cdFx0XHRcdFx0dkF4ZXM6IHtcblx0XHRcdFx0XHRcdDA6IHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0OiAnY3VycmVuY3knLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdDE6IHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0OiAnJyxcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSxcblx0XHRcdH07XG5cdFx0XHRcdC8vIGRhdGEgPSBnb29nbGUudmlzdWFsaXphdGlvbi5hcnJheVRvRGF0YVRhYmxlKCBbXG5cdFx0XHRcdC8vIFsnTW9udGgnLCAnQm9saXZpYScsICdFY3VhZG9yJywgJ01hZGFnYXNjYXInLCAnUGFwdWEgTmV3IEd1aW5lYScsICdSd2FuZGEnLCAnQXZlcmFnZSddLFxuXHRcdFx0XHQvLyBbJzIwMDQvMDUnLCAgMTY1LCAgICAgIDkzOCwgICAgICAgICA1MjIsICAgICAgICAgICAgIDk5OCwgICAgICAgICAgIDQ1MCwgICAgICA2MTQuNl0sXG5cdFx0XHRcdC8vIFsnMjAwNS8wNicsICAxMzUsICAgICAgMTEyMCwgICAgICAgIDU5OSwgICAgICAgICAgICAgMTI2OCwgICAgICAgICAgMjg4LCAgICAgIDY4Ml0sXG5cdFx0XHRcdC8vIFsnMjAwNi8wNycsICAxNTcsICAgICAgMTE2NywgICAgICAgIDU4NywgICAgICAgICAgICAgODA3LCAgICAgICAgICAgMzk3LCAgICAgIDYyM10sXG5cdFx0XHRcdC8vIFsnMjAwNy8wOCcsICAxMzksICAgICAgMTExMCwgICAgICAgIDYxNSwgICAgICAgICAgICAgOTY4LCAgICAgICAgICAgMjE1LCAgICAgIDYwOS40XSxcblx0XHRcdFx0Ly8gWycyMDA4LzA5JywgIDEzNiwgICAgICA2OTEsICAgICAgICAgNjI5LCAgICAgICAgICAgICAxMDI2LCAgICAgICAgICAzNjYsICAgICAgNTY5LjZdXG5cdFx0XHRcdC8vIF0gKVxuXG5cdFx0XHRpZiAoIGRhdGEubGVuZ3RoICkge1xuXG5cdFx0XHRcdGRhdGEgPSBnb29nbGUudmlzdWFsaXphdGlvbi5hcnJheVRvRGF0YVRhYmxlKCBkYXRhICk7XG5cdFx0XHRcdGRhdGEuc29ydCggW3tjb2x1bW46IDB9XSApO1xuXHRcdFx0XHRjaGFydC5kcmF3KCBkYXRhLCBvcHRpb25zICk7XG5cblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDaGVjayBpZiBhIHdpZGdldCBpcyBzdGlsbCBsb2FkaW5nXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICAgYm9vbFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaXNfbG9hZGluZ19maW5pc2hlZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAkKCAnLmxsbXMtd2lkZ2V0LmlzLWxvYWRpbmcnICkubGVuZ3RoICkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU3RhcnQgbG9hZGluZyBhbGwgd2lkZ2V0cyBvbiB0aGUgY3VycmVudCBzY3JlZW5cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5sb2FkX3dpZGdldHMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLiR3aWRnZXRzLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdHNlbGYubG9hZF93aWRnZXQoICQoIHRoaXMgKSApO1xuXG5cdFx0XHR9ICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogTG9hZCBhIHNwZWNpZmljIHdpZGdldFxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICAgIG9iaiAgICR3aWRnZXQgIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgd2lkZ2V0IGVsZW1lbnRcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjE2Ljhcblx0XHQgKi9cblx0XHR0aGlzLmxvYWRfd2lkZ2V0ID0gZnVuY3Rpb24oICR3aWRnZXQgKSB7XG5cblx0XHRcdHZhciBzZWxmICAgICAgICAgPSB0aGlzLFxuXHRcdFx0XHRtZXRob2QgICAgICAgPSAkd2lkZ2V0LmF0dHIoICdkYXRhLW1ldGhvZCcgKSxcblx0XHRcdFx0JGNvbnRlbnQgICAgID0gJHdpZGdldC5maW5kKCAnaDEnICksXG5cdFx0XHRcdCRyZXRyeSAgICAgICA9ICR3aWRnZXQuZmluZCggJy5sbG1zLXJlbG9hZC13aWRnZXQnICksXG5cdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKSxcblx0XHRcdFx0c3RhdHVzO1xuXG5cdFx0XHQkd2lkZ2V0LmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuXHRcdFx0JC5hamF4KCB7XG5cblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ2xsbXNfd2lkZ2V0XycgKyBtZXRob2QsXG5cdFx0XHRcdFx0ZGF0ZXM6IHNlbGYucXVlcnkuZGF0ZXMsXG5cdFx0XHRcdFx0Y291cnNlczogc2VsZi5xdWVyeS5jdXJyZW50X2NvdXJzZXMsXG5cdFx0XHRcdFx0bWVtYmVyc2hpcHM6IHNlbGYucXVlcnkuY3VycmVudF9tZW1iZXJzaGlwcyxcblx0XHRcdFx0XHRzdHVkZW50czogc2VsZi5xdWVyeS5jdXJyZW50X3N0dWRlbnRzLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0dGltZW91dDogc2VsZi50aW1lb3V0LFxuXHRcdFx0XHR1cmw6IHdpbmRvdy5hamF4dXJsLFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdHN0YXR1cyA9ICdzdWNjZXNzJztcblxuXHRcdFx0XHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiByLnJlc3BvbnNlICkge1xuXG5cdFx0XHRcdFx0XHRjb250ZW50X3RleHQgPSByLnJlc3BvbnNlO1xuXG5cdFx0XHRcdFx0XHRzZWxmLmRhdGFbbWV0aG9kXSA9IHtcblx0XHRcdFx0XHRcdFx0Y2hhcnRfZGF0YTogci5jaGFydF9kYXRhLFxuXHRcdFx0XHRcdFx0XHRyZXNwb25zZTogci5yZXNwb25zZSxcblx0XHRcdFx0XHRcdFx0cmVzdWx0czogci5yZXN1bHRzLFxuXHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0JHJldHJ5LnJlbW92ZSgpO1xuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdHN0YXR1cyA9ICdlcnJvcic7XG5cblx0XHRcdFx0fSxcblx0XHRcdFx0Y29tcGxldGU6IGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0aWYgKCAnZXJyb3InID09PSBzdGF0dXMgKSB7XG5cblx0XHRcdFx0XHRcdGlmICggJ3RpbWVvdXQnID09PSByLnN0YXR1c1RleHQgKSB7XG5cblx0XHRcdFx0XHRcdFx0Y29udGVudF90ZXh0ID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ1JlcXVlc3QgdGltZWQgb3V0JyApO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoICEgJHJldHJ5Lmxlbmd0aCApIHtcblxuXHRcdFx0XHRcdFx0XHQkcmV0cnkgPSAkKCAnPGEgY2xhc3M9XCJsbG1zLXJlbG9hZC13aWRnZXRcIiBocmVmPVwiI1wiPicgKyBMTE1TLmwxMG4udHJhbnNsYXRlKCAnUmV0cnknICkgKyAnPC9hPicgKTtcblx0XHRcdFx0XHRcdFx0JHJldHJ5Lm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmxvYWRfd2lkZ2V0KCAkd2lkZ2V0ICk7XG5cblx0XHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0XHRcdCR3aWRnZXQuYXBwZW5kKCAkcmV0cnkgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0JHdpZGdldC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cdFx0XHRcdFx0JGNvbnRlbnQuaHRtbCggY29udGVudF90ZXh0ICk7XG5cblx0XHRcdFx0XHRzZWxmLndpZGdldF9maW5pc2hlZCggJHdpZGdldCApO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEdldCB0aGUgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gdGhlIHF1ZXJpZWQgZGF0ZXNcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gICBpbnRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9kYXRlX2RpZmYgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIGVuZCAgID0gbmV3IERhdGUoIHRoaXMucXVlcnkuZGF0ZXMuZW5kICksXG5cdFx0XHRcdHN0YXJ0ID0gbmV3IERhdGUoIHRoaXMucXVlcnkuZGF0ZXMuc3RhcnQgKTtcblxuXHRcdFx0cmV0dXJuIE1hdGguYWJzKCBlbmQuZ2V0VGltZSgpIC0gc3RhcnQuZ2V0VGltZSgpICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQnVpbGRzIGFuIG9iamVjdCBvZiBkYXRhIHRoYXQgY2FuIGJlIHVzZWQgdG8sIHVsdGltYXRlbHksIGRyYXcgdGhlIHNjcmVlbidzIGNoYXJ0XG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMS42XG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfZGF0YV9vYmplY3QgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgICAgICAgICA9IHRoaXMsXG5cdFx0XHRcdG1heF9mb3JfZGF5cyA9ICggKCAxMDAwICogMzYwMCAqIDI0ICkgKiAzMCApICogNCwgLy8gNCBtb250aHMgaW4gc2Vjb25kc1xuXHRcdFx0XHRkaWZmICAgICAgICAgPSB0aGlzLmdldF9kYXRlX2RpZmYoKSxcblx0XHRcdFx0ZGF0YSAgICAgICAgID0ge30sXG5cdFx0XHRcdHJlcywgaSwgZCwgZGF0ZTtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhIHx8ICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzID0gc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzO1xuXG5cdFx0XHRcdGlmICggcmVzICkge1xuXG5cdFx0XHRcdFx0Zm9yICggaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKysgKSB7XG5cblx0XHRcdFx0XHRcdGQgPSB0aGlzLmluaXRfZGF0ZSggcmVzW2ldLmRhdGUgKTtcblxuXHRcdFx0XHRcdFx0Ly8gZ3JvdXAgYnkgZGF5c1xuXHRcdFx0XHRcdFx0aWYgKCBkaWZmIDw9IG1heF9mb3JfZGF5cyApIHtcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IG5ldyBEYXRlKCBkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8vIGdyb3VwIGJ5IG1vbnRoc1xuXHRcdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGRhdGUgPSBuZXcgRGF0ZSggZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIDEgKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCAhIGRhdGFbIGRhdGUgXSApIHtcblx0XHRcdFx0XHRcdFx0ZGF0YVsgZGF0ZSBdID0gdGhpcy5nZXRfZW1wdHlfZGF0YV9vYmplY3QoIGRhdGUgKVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzd2l0Y2ggKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEudHlwZSApIHtcblxuXHRcdFx0XHRcdFx0XHRjYXNlICdhbW91bnQnOlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0gPSBkYXRhWyBkYXRlIF1bIG1ldGhvZCBdICsgKCByZXNbaV1bIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS5rZXkgXSAqIDEgKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSAnY291bnQnOlxuXHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0rKztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IHRoZSBkYXRhIGdvb2dsZSBjaGFydHMgbmVlZHMgdG8gaW5pdGlhdGUgdGhlIGN1cnJlbnQgY2hhcnRcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gICBvYmpcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9kYXRhID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0b2JqICA9IHNlbGYuZ2V0X2NoYXJ0X2RhdGFfb2JqZWN0KCksXG5cdFx0XHRcdGRhdGEgPSBzZWxmLmdldF9jaGFydF9oZWFkZXJzKCk7XG5cblx0XHRcdGZvciAoIHZhciBkYXRlIGluIG9iaiApIHtcblxuXHRcdFx0XHRpZiAoICEgb2JqLmhhc093blByb3BlcnR5KCBkYXRlICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgcm93ID0gWyBvYmpbIGRhdGUgXS5fZGF0ZSBdO1xuXG5cdFx0XHRcdGZvciAoIHZhciBpdGVtIGluIG9ialsgZGF0ZSBdICkge1xuXHRcdFx0XHRcdGlmICggISBvYmpbIGRhdGUgXS5oYXNPd25Qcm9wZXJ0eSggaXRlbSApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gc2tpcCBtZXRhIGl0ZW1zXG5cdFx0XHRcdFx0aWYgKCAwID09PSBpdGVtLmluZGV4T2YoICdfJyApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cm93LnB1c2goIG9ialsgZGF0ZSBdWyBpdGVtIF0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRhdGEucHVzaCggcm93ICk7XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IGEgc3R1YiBvZiB0aGUgZGF0YSBvYmplY3QgdXNlZCBieSB0aGlzLmdldF9kYXRhX29iamVjdFxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICAgIHN0cmluZyAgIGRhdGUgIGRhdGUgdG8gaW5zdGFudGlhdGUgdGhlIG9iamVjdCB3aXRoXG5cdFx0ICogQHJldHVybiAgIG9ialxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X2VtcHR5X2RhdGFfb2JqZWN0ID0gZnVuY3Rpb24oIGRhdGUgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0b2JqICA9IHtcblx0XHRcdFx0XHRfZGF0ZTogZGF0ZSxcblx0XHRcdH07XG5cblx0XHRcdGZvciAoIHZhciBtZXRob2QgaW4gc2VsZi5kYXRhICkge1xuXHRcdFx0XHRpZiAoICEgc2VsZi5kYXRhLmhhc093blByb3BlcnR5KCBtZXRob2QgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhICkge1xuXHRcdFx0XHRcdG9ialsgbWV0aG9kIF0gPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9iajtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCdWlsZHMgYW4gYXJyYXkgb2YgY2hhcnQgaGVhZGVyIGRhdGFcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gICBhcnJheVxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X2NoYXJ0X2hlYWRlcnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRoICAgID0gW107XG5cblx0XHRcdC8vIGRhdGUgaGVhZGVycyBnbyBmaXJzdFxuXHRcdFx0aC5wdXNoKCB7XG5cdFx0XHRcdGxhYmVsOiBMTE1TLmwxMG4udHJhbnNsYXRlKCAnRGF0ZScgKSxcblx0XHRcdFx0aWQ6ICdkYXRlJyxcblx0XHRcdFx0dHlwZTogJ2RhdGUnLFxuXHRcdFx0fSApO1xuXG5cdFx0XHRmb3IgKCB2YXIgbWV0aG9kIGluIHNlbGYuZGF0YSApIHtcblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YSApIHtcblx0XHRcdFx0XHRoLnB1c2goIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS5oZWFkZXIgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBbIGggXTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBHZXQgYSBvYmplY3Qgb2Ygc2VyaWVzIG9wdGlvbnMgbmVlZGVkIHRvIGRyYXcgdGhlIGNoYXJ0LlxuXHRcdCAqXG5cdFx0ICogQHNpbmNlIDMuMC4wXG5cdFx0ICogQHNpbmNlIEZpeCBpc3N1ZSB0aGF0IHByb2R1Y2VkIHNlcmllcyBvcHRpb25zIG5vdCBhbGlnbmVkIHdpdGggdGhlIGNoYXJ0IGRhdGEuXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9zZXJpZXNfb3B0aW9ucyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiAgICA9IHRoaXMsXG5cdFx0XHRcdG9wdGlvbnMgPSB7fVxuXHRcdFx0XHRpICAgICAgID0gMDtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cdFx0XHRcdGlmICggISBzZWxmLmRhdGEuaGFzT3duUHJvcGVydHkoIG1ldGhvZCApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEgKSB7XG5cblx0XHRcdFx0XHR2YXIgdHlwZSA9IHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS50eXBlO1xuXG5cdFx0XHRcdFx0b3B0aW9uc1sgaSBdID0ge1xuXHRcdFx0XHRcdFx0dHlwZTogKCAnY291bnQnID09PSB0eXBlICkgPyAnYmFycycgOiAnbGluZScsXG5cdFx0XHRcdFx0XHR0YXJnZXRBeGlzSW5kZXg6ICggJ2NvdW50JyA9PT0gdHlwZSApID8gMSA6IDAsXG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdGkrKztcblxuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9wdGlvbnM7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5zdGFudGlhdGUgYSBEYXRlIGluc3RhbmNlIHZpYSBhIGRhdGUgc3RyaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gICAgc3RyaW5nICAgc3RyaW5nICBkYXRlIHN0cmluZywgZXhwZWN0ZWQgZm9ybWF0IHNob3VsZCBiZSBmcm9tIHBocCBkYXRlKCAnWS1tLWQgSDppOnMnIClcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMS40XG5cdFx0ICogQHZlcnNpb24gIDMuMS41XG5cdFx0ICovXG5cdFx0dGhpcy5pbml0X2RhdGUgPSBmdW5jdGlvbiggc3RyaW5nICkge1xuXG5cdFx0XHR2YXIgcGFydHMsIGRhdGUsIHRpbWU7XG5cblx0XHRcdHBhcnRzID0gc3RyaW5nLnNwbGl0KCAnICcgKTtcblxuXHRcdFx0ZGF0ZSA9IHBhcnRzWzBdLnNwbGl0KCAnLScgKTtcblx0XHRcdHRpbWUgPSBwYXJ0c1sxXS5zcGxpdCggJzonICk7XG5cblx0XHRcdHJldHVybiBuZXcgRGF0ZSggZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIHRpbWVbMF0sIHRpbWVbMV0sIHRpbWVbMl0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgd2hlbiBhIHdpZGdldCBpcyBmaW5pc2hlZCBsb2FkaW5nXG5cdFx0ICogVXBkYXRlcyB0aGUgY3VycmVudCBjaGFydCB3aXRoIHRoZSBuZXcgZGF0YSBmcm9tIHRoZSB3aWRnZXRcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgICBvYmogICAkd2lkZ2V0ICBqUXVlcnkgc2VsZWN0b3Igb2YgdGhlIHdpZGdldCBlbGVtZW50XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLndpZGdldF9maW5pc2hlZCA9IGZ1bmN0aW9uKCAkd2lkZ2V0ICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfbG9hZGluZ19maW5pc2hlZCgpICkge1xuXHRcdFx0XHR0aGlzLmRyYXdfY2hhcnQoKTtcblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvLyBnb1xuXHRcdHRoaXMuaW5pdCgpO1xuXG5cdFx0Ly8gcmV0dXJuXG5cdFx0cmV0dXJuIHRoaXM7XG5cblx0fTtcblxuXHR3aW5kb3cubGxtcy5hbmFseXRpY3MgPSBuZXcgQW5hbHl0aWNzKCk7XG5cbn0gKSggalF1ZXJ5ICk7XG4iXX0=
